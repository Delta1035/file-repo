---
link: null
title: ç å³°æ¶æ„å¸ˆæˆé•¿è®¡åˆ’
description: è¿‡åº¦ä½¿ç”¨ç»§æ‰¿æˆ–è€…è¯´ç»§æ‰¿å±‚æ¬¡è¿‡æ·±ä¼šå¯¼è‡´ä»£ç å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å˜å·®
å­ç±»å’Œçˆ¶ç±»é«˜åº¦è€¦åˆï¼Œä¿®æ”¹çˆ¶ç±»çš„ä»£ç ï¼Œä¼šç›´æ¥å½±å“åˆ°å­ç±»
keywords: null
author: null
date: null
publisher: ç å³°æ¶æ„å¸ˆæˆé•¿è®¡åˆ’
stats: paragraph=547 sentences=1273, words=9036
---
## 1. ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ [#](#t01-ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡)

* ä»¥ç±»å’Œå¯¹è±¡ä½œä¸ºç»„ç»‡ä»£ç çš„åŸºæœ¬å•ä½ï¼Œå¹¶å®ç°å°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€å››ä¸ªç‰¹æ€§
* è½¯ä»¶å¼€å‘ç»å†åˆ†æã€è®¾è®¡å’Œç¼–ç ä¸‰ä¸ªé˜¶æ®µ
  - é¢å‘å¯¹è±¡åˆ†æ(OOA) Object Oriented Analysis
  - é¢å‘å¯¹è±¡è®¾è®¡(OOD) Object Oriented Design
  - é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)Object Oriented Programming

### 1.1 æŠ½è±¡(Abstraction) [#](#t111-æŠ½è±¡abstraction)

* æŠ½è±¡ä¸»è¦æ˜¯éšè—æ–¹æ³•çš„å®ç°ï¼Œè®©è°ƒç”¨è€…åªå…³å¿ƒæœ‰å“ªäº›åŠŸèƒ½è€Œä¸æ˜¯å…³å¿ƒåŠŸèƒ½çš„å®ç°
* æŠ½è±¡å¯ä»¥æé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ï¼Œä¿®æ”¹å®ç°ä¸éœ€è¦æ”¹å˜å®šä¹‰ï¼Œå¯ä»¥å‡å°‘ä»£ç çš„æ”¹åŠ¨èŒƒå›´

```js
interface IStorage {
    save(key: any, value: any): void;
    read(key: any): void;
}
class LocalStorage implements IStorage {
    save(key: any, value: any) {
        localStorage.setItem(key, value);
    }
    read(key: any) {
        return localStorage.getItem(key);
    }
}
class User {
    constructor(public name: string, public storage: IStorage) {

    }
    save() {
        this.storage.save('userInfo', JSON.stringify(this));
    }
    read() {
        return this.storage.read('userInfo');
    }
}
let user = new User('å¼ ä¸‰', new LocalStorage());
user.save();
user.read();
```

### 1.2 ç»§æ‰¿ [#](#t212-ç»§æ‰¿)

* ç»§æ‰¿ä¸»è¦çš„è¦å¤„æ˜¯å®ç°ä»£ç å¤ç”¨
* ç»§æ‰¿å¯ä»¥æŠŠçˆ¶ç±»å’Œå­ç±»çš„å…¬å…±æ–¹æ³•æŠ½ç¦»å‡ºæ¥ï¼Œæé«˜å¤ç”¨ï¼Œå‡å°‘å†—ä½™
* æ˜¯ä¸€ç§ `is-a` å…³ç³»

```js
export { };
class Animal {
    name: string;
    constructor(name: string) {
        this.name = name;
    }
    eat() {
        console.log(`${this.name} eat`)
    }
}
let animal = new Animal('åŠ¨ç‰©');
animal.eat();

class Dog extends Animal {
    age: number;
    constructor(name: string, age: number) {
        super(name);
        this.age = age;
    }
    speak() {
        console.log(`${this.name} is barking!`);
    }
}
let dog = new Dog('ğŸ¶', 5);
dog.eat();
dog.speak();
```

> è¿‡åº¦ä½¿ç”¨ç»§æ‰¿æˆ–è€…è¯´ç»§æ‰¿å±‚æ¬¡è¿‡æ·±ä¼šå¯¼è‡´ä»£ç å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å˜å·® å­ç±»å’Œçˆ¶ç±»é«˜åº¦è€¦åˆï¼Œä¿®æ”¹çˆ¶ç±»çš„ä»£ç ï¼Œä¼šç›´æ¥å½±å“åˆ°å­ç±»

### 1.3 å°è£… [#](#t313-å°è£…)

* æŠŠæ•°æ®å°è£…èµ·æ¥
* å‡å°‘è€¦åˆï¼Œä¸è¯¥å¤–éƒ¨è®¿é—®çš„ä¸è¦è®©å¤–éƒ¨è®¿é—®
* åˆ©äºæ•°æ®çš„æ¥å£æƒé™ç®¡ç†
* ä»…æš´éœ²æœ‰é™çš„å¿…è¦æ¥å£ï¼Œæé«˜ç±»çš„æ˜“ç”¨æ€§
* å®ç°
  - public:å…¬æœ‰ä¿®é¥°ç¬¦ï¼Œå¯ä»¥åœ¨ç±»å†…æˆ–è€…ç±»å¤–ä½¿ç”¨publicä¿®é¥°çš„å±æ€§æˆ–è€…è¡Œä¸ºï¼Œé»˜è®¤ä¿®é¥°ç¬¦
  - protected:å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦ï¼Œå¯ä»¥æœ¬ç±»å’Œå­ç±»ä¸­ä½¿ç”¨protectedä¿®é¥°çš„å±æ€§å’Œè¡Œä¸º
  - private : ç§æœ‰ä¿®é¥°ç¬¦ï¼Œåªå¯ä»¥åœ¨ç±»å†…ä½¿ç”¨privateä¿®é¥°çš„å±æ€§å’Œè¡Œä¸º

![](http://img.zhufengpeixun.cn/1control.png) ![](http://img.zhufengpeixun.cn/2control.png)

```js
class Animal {
    public name: string;
    protected age: number;
    private weight: number;
    constructor(name: string, age: number, weight: number) {
        this.name = name;
        this.age = age;
        this.weight = weight;
    }
}
class Person extends Animal {
    private money: number;
    constructor(name: string, age: number, weight: number, money: number) {
        super(name, age, weight);
        this.money = money;
    }
    getName() {
        console.log(this.name);
    }
    getAge() {
        console.log(this.age);
    }
    getWeight() {
        console.log(this.weight);
    }
    getMoney() {
        console.log(this.money);
    }
}
let p = new Person('zfpx', 9, 100, 100);
console.log(p.name);
console.log(p.age);
console.log(p.weight);
```

### 1.4 å¤šæ€ [#](#t414-å¤šæ€)

* å¤šæ€æ˜¯æŒ‡ï¼Œå­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»
* ä¿æŒå­ç±»çš„å¼€æ”¾æ€§å’Œçµæ´»æ€§ï¼Œå¯ä»¥é‡å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•
* å®ç°é¢å‘æ¥å£ç¼–ç¨‹

```js
class Animal {
    public name: string;
    protected age: number;
    private weight: number;
    constructor(name: string, age: number, weight: number) {
        this.name = name;
        this.age = age;
        this.weight = weight;
    }
    speak() {
        throw new Error('æ­¤æ–¹æ³•å¿…é¡»ç”±å­ç±»å®ç°!');
    }
}
class Person extends Animal {
    private money: number;
    constructor(name: string, age: number, weight: number, money: number) {
        super(name, age, weight);
        this.money = money;
    }
    getName() {
        console.log(this.name);
    }
    getAge() {
        console.log(this.age);
    }
    getMoney() {
        console.log(this.money);
    }
    speak() {
        console.log('ä½ å¥½!');
    }

}
class Dog extends Animal {
    constructor(name: string, age: number, weight: number) {
        super(name, age, weight);
    }
    speak() {
        console.log('æ±ªæ±ªæ±ª!');
    }
}
let p = new Person('zfpx', 10, 10, 10);
p.speak();
let d = new Dog('zfpx', 10, 10);
d.speak();
```

## 2. è®¾è®¡åŸåˆ™ [#](#t52-è®¾è®¡åŸåˆ™)

### 2.1 ä»€ä¹ˆæ˜¯è®¾è®¡ï¼Ÿ [#](#t621-ä»€ä¹ˆæ˜¯è®¾è®¡)

* æŒ‰å“ªä¸€ç§æ€è·¯æˆ–è€…æ ‡å‡†æ¥å®ç°åŠŸèƒ½
* åŠŸèƒ½ç›¸åŒï¼Œå¯ä»¥æœ‰ä¸åŒè®¾è®¡çš„æ–¹å¼
* éœ€æ±‚å¦‚æœä¸æ–­å˜åŒ–ï¼Œè®¾è®¡çš„ä½œç”¨æ‰èƒ½ä½“ç°å‡ºæ¥

### 2.2 SOLIDäº”å¤§è®¾è®¡åŸåˆ™ [#](#t722-solidäº”å¤§è®¾è®¡åŸåˆ™)

é¦–å­—æ¯ æŒ‡ä»£ æ¦‚å¿µ S å•ä¸€èŒè´£åŸåˆ™ å•ä¸€åŠŸèƒ½åŸåˆ™è®¤ä¸ºå¯¹è±¡åº”è¯¥ä»…å…·æœ‰ä¸€ç§ `&#x5355;&#x4E00;&#x529F;&#x80FD;`

çš„æ¦‚å¿µ O å¼€æ”¾å°é—­åŸåˆ™ å¼€é—­åŸåˆ™è®¤ä¸º `&#x8F6F;&#x4EF6;&#x4F53;&#x5E94;&#x8BE5;&#x662F;&#x5BF9;&#x4E8E;&#x6269;&#x5C55;&#x5F00;&#x653E;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x4FEE;&#x6539;&#x5C01;&#x95ED;&#x7684;`

çš„æ¦‚å¿µ L é‡Œæ°æ›¿æ¢åŸåˆ™ é‡Œæ°æ›¿æ¢åŸåˆ™è®¤ä¸ºç¨‹åºä¸­çš„å¯¹è±¡åº”è¯¥æ˜¯å¯ä»¥åœ¨ä¸æ”¹å˜ç¨‹åºæ­£ç¡®æ€§çš„å‰æä¸‹ `&#x88AB;&#x5B83;&#x7684;&#x5B50;&#x7C7B;&#x6240;&#x66FF;&#x6362;`

çš„çš„æ¦‚å¿µ I æ¥å£éš”ç¦»åŸåˆ™ æ¥å£éš”ç¦»åŸåˆ™è®¤ä¸º `&#x591A;&#x4E2A;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x53E3;&#x8981;&#x597D;&#x4E8E;&#x4E00;&#x4E2A;&#x5BBD;&#x6CDB;&#x7528;&#x9014;&#x7684;&#x63A5;&#x53E3;`

çš„æ¦‚å¿µ D ä¾èµ–åè½¬åŸåˆ™ ä¾èµ–åè½¬åŸåˆ™è®¤ä¸ºä¸€ä¸ªæ–¹æ³•åº”è¯¥éµä» `&#x4F9D;&#x8D56;&#x4E8E;&#x62BD;&#x8C61;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;`

çš„æ¦‚å¿µ,ä¾èµ–æ³¨å…¥æ˜¯è¯¥åŸåˆ™çš„ä¸€ç§å®ç°æ–¹å¼ã€‚

#### 2.2.1 O å¼€æ”¾å°é—­åŸåˆ™ [#](#t8221-o-å¼€æ”¾å°é—­åŸåˆ™)

* `Open Closed Principle`
* å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
* å¢åŠ éœ€æ±‚æ—¶ï¼Œæ‰©å±•æ–°ä»£ç ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç 
* å¼€é—­åŸåˆ™æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„æ€»åŸåˆ™
* å¯¹è¿‘æœŸå¯èƒ½ä¼šå˜åŒ–å¹¶ä¸”å¦‚æœæœ‰å˜åŒ–ä½†æ”¹åŠ¨é‡å·¨å¤§çš„åœ°æ–¹è¦å¢åŠ æ‰©å±•ç‚¹,æ‰©å±•ç‚¹è¿‡å¤šä¼šé™ä½å¯è¯»æ€§

```js
class Customer {
    constructor(public rank: string) { }
}
class Product {
    constructor(public name: string, public price: number) {

    }
    cost(customer: Customer) {
        switch (customer.rank) {
            case 'member':
                return this.price * .8;
            case 'vip':
                return this.price * .6;
            default:
                return this.price;
        }
    }
}
let p1 = new Product('ç¬”è®°æœ¬ç”µè„‘', 1000);
let member = new Customer('member');
let vip = new Customer('vip');
let guest = new Customer('guest');
console.log(p1.cost(member));
console.log(p1.cost(vip));
console.log(p1.cost(guest));
```

```diff
class Customer {
+    constructor(public rank: string, public discount: number = 1) { }
+    getDiscount() {
+        return this.discount;
+    }
}
class Product {
    constructor(public name: string, public price: number) {

    }
    cost(customer: Customer) {
-        /*  switch (customer.rank) {
-             case 'member':
-                 return this.price * .8;
-             case 'vip':
-                 return this.price * .6;
-             default:
-                 return this.price;
-         } */
+        return this.price * customer.getDiscount();
    }
}
+let p1 = new Product('ç¬”è®°æœ¬ç”µè„‘', 1000);
+let member = new Customer('member', .8);
+let vip = new Customer('vip', .6);
let guest = new Customer('guest');
console.log(p1.cost(member));
console.log(p1.cost(vip));
console.log(p1.cost(guest));
```

```js
import axios, { AxiosInstance, AxiosRequestConfig } from 'axios';
let instance: AxiosInstance = axios.create();
instance.interceptors.request.use((config: AxiosRequestConfig) => {
    config.url = 'http://localhost:8080' + config.url;
    return config;
});

instance.interceptors.response.use(response => {
    if (response.status !== 200 || response.data.code != 0) {
        return Promise.reject(response);
    } else {
        return response.data.data;
    }
})

instance({
    url: '/api/users'
}).then(result => {
    console.log(result);
}, error => {
    console.error(error);
});
```

#### 2.2.2 S å•ä¸€èŒè´£åŸåˆ™ [#](#t9222-s-å•ä¸€èŒè´£åŸåˆ™)

* Single responsibility principle
* ä¸€ä¸ªç±»æˆ–è€…æ¨¡å—åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£,å¦‚æœåŠŸèƒ½ç‰¹åˆ«å¤æ‚å°±è¿›è¡Œæ‹†åˆ†
* å•ä¸€èŒè´£å¯ä»¥é™ä½ç±»çš„å¤æ‚æ€§ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§
* å½“ç±»ä»£ç è¡Œæ•°è¿‡å¤šã€æ–¹æ³•è¿‡å¤šã€åŠŸèƒ½å¤ªå¤šã€èŒè´£å¤ªæ‚çš„æ—¶å€™å°±è¦å¯¹ç±»è¿›è¡Œæ‹†åˆ†äº†
* æ‹†åˆ†ä¸èƒ½è¿‡åº¦ï¼Œå¦‚æœæ‹†åˆ†è¿‡åº¦ä¼šæŸå¤±å†…èšæ€§å’Œç»´æŠ¤æ€§
* [lodashjs](https://www.lodashjs.com/docs/latest)
* [jquery](https://api.jquery.com/)

![](http://img.zhufengpeixun.cn/product.png)

```diff
class Product {
    public name: string;
-    public categoryName: string;
-    public categoryIcon: string;
+     public category:Category;
}
+class Category {
+    public name: string;
+    public icon: string;
+}
```

#### 2.2.3 L é‡Œæ°æ›¿æ¢åŸåˆ™ [#](#t10223-l-é‡Œæ°æ›¿æ¢åŸåˆ™)

* Liskov Substitution Principle
* æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡
* å­ç±»èƒ½æ›¿æ¢æ‰çˆ¶ç±»ï¼Œä½¿ç”¨è€…å¯èƒ½æ ¹æœ¬å°±ä¸éœ€è¦çŸ¥é“æ˜¯çˆ¶ç±»è¿˜æ˜¯å­ç±»,åä¹‹åˆ™ä¸è¡Œ
* é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯å¼€é—­åŸåˆ™çš„å®ç°åŸºç¡€,ç¨‹åºè®¾è®¡çš„æ—¶å€™å°½é‡ä½¿ç”¨åŸºç±»å®šä¹‰åŠå¼•ç”¨ï¼Œè¿è¡Œæ—¶å†å†³å®šä½¿ç”¨å“ªä¸ªå­ç±»
* é‡Œæ°æ›¿æ¢åŸåˆ™å¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§ï¼Œä¹Ÿå¢åŠ äº†è€¦åˆæ€§
* ç›¸å¯¹äºå¤šæ€ï¼Œè¿™ä¸ªåŸåˆ™æ˜¯è®²çš„æ˜¯ç±»å¦‚ä½•è®¾è®¡ï¼Œå­ç±»å¦‚æœè¿åäº†çˆ¶ç±»çš„åŠŸèƒ½åˆ™è¡¨ç¤ºè¿åäº†é‡Œæ°æ›¿æ¢åŸåˆ™

![](http://img.zhufengpeixun.cn/3.Substitution.png)

```js
abstract class AbstractDrink {
    abstract getName(): string;
}
class CocaCola extends AbstractDrink {
    getName(): string {
        return 'å¯ä¹';
    }
}
class Sprite extends AbstractDrink {
    getName(): string {
        return 'é›ªç¢§';
    }
}
class Fanta extends AbstractDrink {
    getName(): string {
        return 'èŠ¬è¾¾';
    }
}
class Customer {
    drink(drink: AbstractDrink) {
        console.log('å–' + drink.getName());
    }
}
let customer = new Customer();
let cocaCola = new CocaCola();
let sprite = new Sprite();
let fanta = new Fanta();
customer.drink(cocaCola);
customer.drink(sprite);
customer.drink(fanta);
```

```js
import React from 'react';
import ReactDOM from 'react-dom';
class App extends React.Component {
    render() {
        return (
            <div>App div>
        )
    }
}
let element = React.createElement(App);
ReactDOM.render(element, document.getElementById('root'));
```

```js
abstract class AbstractDrink {
    abstract getName(): any;
}
class CocaCola extends AbstractDrink {
    getName(): any {
        return 100;
    }
}
```

#### 2.2.4 D ä¾èµ–å€’ç½®åŸåˆ™ [#](#t11224-d-ä¾èµ–å€’ç½®åŸåˆ™)

* Dependence Inversion Principle
* é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“å®ç°
* è¦æ±‚æˆ‘ä»¬åœ¨ç¨‹åºä»£ç ä¸­ä¼ é€’å‚æ•°æ—¶æˆ–åœ¨å…³è”å…³ç³»ä¸­ï¼Œå°½é‡å¼•ç”¨å±‚æ¬¡é«˜çš„æŠ½è±¡å±‚ç±»
* ä½¿ç”¨æ–¹åªå…³æ³¨æ¥å£è€Œä¸å…³æ³¨å…·ä½“ç±»çš„å®ç°

![](http://img.zhufengpeixun.cn/5.Inversion.png)

```js
abstract class GirlFriend {
    public age: number;
    public height: number;
    public abstract cook(): void;
}
class LinZhiLing extends GirlFriend {
    public cook(): void {

    }
}
class HanMeiMei extends GirlFriend {
    public cook(): void {

    }
}
class SingleDog {
    constructor(public girlFriend: GirlFriend) {

    }
}
let s1 = new SingleDog(new LinZhiLing());
let s2 = new SingleDog(new HanMeiMei());
```

```js
import { createStore } from 'redux';
let store = createStore(state => state);
export interface Action {
    type: T
}
export interface AnyAction extends Action {

    [extraProps: string]: any
}
let action: AnyAction = { type: 'increment', payload: 5 }
store.dispatch(action);
```

#### 2.2.5 I æ¥å£éš”ç¦»åŸåˆ™ [#](#t12225-i-æ¥å£éš”ç¦»åŸåˆ™)

* Interface Segregation Principle
* ä¿æŒæ¥å£çš„å•ä¸€ç‹¬ç«‹ï¼Œé¿å…å‡ºç°èƒ–æ¥å£
* å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œç±»é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š
* æ¥å£å°½é‡ç»†åŒ–ï¼Œè€Œä¸”æ¥å£ä¸­çš„æ–¹æ³•å°½é‡çš„å°‘
* ç±»ä¼¼äºå•ä¸€èŒè´£åŸåˆ™ï¼Œæ›´å…³æ³¨æ¥å£

```js
interface IUserManager {
    updateUserInfo(): void;
    updatePassword(): void;
}
interface IProductManager {
    updateProduct(): void;
    updatePrice(): void;
}
```

![](http://img.zhufengpeixun.cn/play.jpg)

```js
interface Running {
    run(): void;
}
interface Flying {
    fly(): void;
}
interface Swimming {
    swim(): void;
}
class Automobile implements Running, Flying, Swimming {
    run() { }
    fly() { }
    swim() { }
}
```

### 2.3 è¿ªç±³ç‰¹æ³•åˆ™ [#](#t1323-è¿ªç±³ç‰¹æ³•åˆ™)

* Law of Demeterï¼ŒLOD
* æœ‰æ—¶å€™ä¹Ÿå«åšæœ€å°‘çŸ¥è¯†åŸåˆ™
* ä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶å®ƒå®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨
* è¿ªç±³ç‰¹æ³•åˆ™çš„åˆè¡·åœ¨äºé™ä½ç±»ä¹‹é—´çš„è€¦åˆ
* ç±»å®šä¹‰æ—¶å°½é‡è¦å®ç°å†…èš,å°‘ä½¿ç”¨ `public`ä¿®é¥°ç¬¦ï¼Œå°½é‡ä½¿ç”¨ `private`ã€ `protected` ç­‰

![](http://img.zhufengpeixun.cn/6.Demeter.png)

```js
class Salesman {
    constructor(public name: string) {

    }
    sale() {
        console.log(this.name + ' é”€å”®ä¸­....');
    }
}
class SaleManager {
    private salesmen: Array = [new Salesman('å¼ ä¸‰'), new Salesman('æå››')];
    sale() {
        this.salesmen.forEach(salesman => salesman.sale());
    }
}
class CEO {
    private saleManager: SaleManager = new SaleManager();
    sale() {
        this.saleManager.sale();
    }
}
let ceo = new CEO();
ceo.sale();
```

### 2.4 åˆæˆå¤ç”¨åŸåˆ™ [#](#t1424-åˆæˆå¤ç”¨åŸåˆ™)

#### 2.4.1 ç±»çš„å…³ç³» [#](#t15241-ç±»çš„å…³ç³»)

* ç±»ä¹‹é—´æœ‰ä¸‰ç§åŸºæœ¬å…³ç³»ï¼Œåˆ†åˆ«æ˜¯å…³è”(èšåˆå’Œç»„åˆ)ã€æ³›åŒ–å’Œä¾èµ–
* å¦‚æœä¸€ä¸ªç±»å•å‘ä¾èµ–å¦ä¸€ä¸ªç±»,é‚£ä¹ˆå®ƒä»¬ä¹‹é—´å°±æ˜¯å•å‘å…³è”ã€‚å¦‚æœå½¼æ­¤ä¾èµ–,åˆ™ä¸ºç›¸äº’ä¾èµ–,å³åŒå‘å…³è”
* å…³è”å…³ç³»åŒ…æ‹¬ä¸¤ç§ç‰¹ä¾‹ï¼šèšåˆå’Œç»„åˆ
  - èšåˆï¼Œç”¨æ¥è¡¨ç¤ºæ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»æˆ–è€… `&#x62E5;&#x6709;`å…³ç³»,ä»£è¡¨éƒ¨åˆ†çš„å¯¹è±¡å¯èƒ½ä¼šè¢«æ•´ä½“æ‹¥æœ‰ï¼Œä½†å¹¶ä¸å®šå®šä¼šéšç€æ•´ä½“çš„æ¶ˆäº¡è€Œé”€æ¯,æ¯”å¦‚ç­çº§å’Œå­¦ç”Ÿ
  - åˆæˆæˆ–è€…è¯´ç»„åˆè¦æ¯”èšåˆå…³ç³»å¼ºçš„å¤šï¼Œéƒ¨åˆ†å’Œæ•´ä½“çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€è‡´çš„,æ¯”å¦‚äººå’Œå™¨å®˜ä¹‹é—´

![](http://img.zhufengpeixun.cn/xinyuanjieyi.png)

![](http://img.zhufengpeixun.cn/7.composite.png)

#### 2.4.2 åˆæˆå¤ç”¨åŸåˆ™ [#](#t16242-åˆæˆå¤ç”¨åŸåˆ™)

* åˆæˆå¤ç”¨åŸåˆ™æ˜¯é€šè¿‡å°†å·²æœ‰çš„å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½œä¸ºæ–°å¯¹è±¡çš„æˆå‘˜å¯¹è±¡æ¥å®ç°çš„
* æ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œä»è€Œè¾¾åˆ°å¤ç”¨
* åŸåˆ™æ˜¯å°½é‡é¦–å…ˆä½¿ç”¨ç»„åˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿
* ä¸“ä¸šäººåšä¸“ä¸šäº‹

```js
class Cooker {
    cook() {

    }
}
class Person {
    private cooker: Cooker = new Cooker();
    cook() {
        this.cooker.cook();
    }
}
```

### 2.5 æ€»ç»“ [#](#t1725-æ€»ç»“)

* å¼€é—­åŸåˆ™æ˜¯æ ¸å¿ƒï¼Œå¯¹ä¿®æ”¹å…³é—­å¯¹æ‰©å±•å¼€æ”¾æ˜¯è½¯ä»¶è®¾è®¡çš„åŸºçŸ³
* å•ä¸€èŒè´£è¦æ±‚æˆ‘ä»¬è®¾è®¡æ¥å£å’Œæ¨¡å—åŠŸèƒ½çš„æ—¶å€™å°½é‡ä¿è¯å•ä¸€æ€§å’ŒåŸå­æ€§ï¼Œä¿®æ”¹ä¸€æ¡ä¸å½±å“å…¨å±€å’Œå…¶å®ƒæ¨¡å—
* é‡Œæ°æ›¿æ¢åŸåˆ™å’Œä¾èµ–å€’ç½®åŸåˆ™è¦æ±‚é¢å‘æ¥å£å’ŒæŠ½è±¡ç¼–ç¨‹,ä¸è¦ä¾èµ–å…·ä½“å®ç°ï¼Œå¦åˆ™å®ç°ä¸€æ”¹ï¼Œä¸Šå±‚è°ƒç”¨è€…å°±è¦å¯¹åº”ä¿®æ”¹

### 2.6 å¦‚ä½•å†™å‡ºå¥½ä»£ç ? [#](#t1826-å¦‚ä½•å†™å‡ºå¥½ä»£ç )

* å¯ç»´æŠ¤æ€§ BUGæ˜¯å¦å¥½æ”¹?

* å¯è¯»æ€§ æ˜¯å¦å®¹æ˜“çœ‹æ‡‚?

* å¯æ‰©å±•æ€§ æ˜¯å¦å¯ä»¥æ·»åŠ æ–°åŠŸèƒ½?

* çµæ´»æ€§ æ·»åŠ æ–°åŠŸèƒ½æ˜¯å¦å®¹æ˜“?è€æ–¹æ³•å’Œæ¥å£æ˜¯å¦å®¹æ˜“å¤ç”¨?

* ç®€æ´æ€§ ä»£ç æ˜¯å¦ç®€å•æ¸…æ™°?

* å¯å¤ç”¨æ€§ ç›¸åŒçš„ä»£ç ä¸è¦å†™2é?

* å¯æµ‹è¯•æ€§ æ˜¯å¦æ–¹ä¾¿å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•?

## 3. 23ç§è®¾è®¡æ¨¡å¼ [#](#t193-23ç§è®¾è®¡æ¨¡å¼)

### 3.1 åˆ›å»ºå‹ [#](#t2031-åˆ›å»ºå‹)

* `&#x91CD;&#x8981;: &#x5DE5;&#x5382;&#x6A21;&#x5F0F;(&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;&#x3001;&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x3001;&#x7B80;&#x5355;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;)&#x3001;&#x5EFA;&#x9020;&#x8005;&#x6A21;&#x5F0F;&#x3001;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;`
* ä¸é‡è¦: åŸå‹æ¨¡å¼

### 3.2 ç»“æ„å‹æ¨¡å¼ [#](#t2132-ç»“æ„å‹æ¨¡å¼)

* `&#x91CD;&#x8981;: &#x4EE3;&#x7406;&#x6A21;&#x5F0F;&#x3001;&#x6865;&#x63A5;&#x6A21;&#x5F0F;&#x3001;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x3001;&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;`
* ä¸é‡è¦: å¤–è§‚æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼

### 3.3 è¡Œä¸ºå‹ [#](#t2233-è¡Œä¸ºå‹)

* `&#x91CD;&#x8981;: &#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x3001;&#x6A21;&#x7248;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;&#x3001;&#x7B56;&#x7565;&#x6A21;&#x5F0F;&#x3001;&#x804C;&#x8D23;&#x94FE;&#x6A21;&#x5F0F;&#x3001;&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;&#x3001;&#x72B6;&#x6001;&#x6A21;&#x5F0F;`
* ä¸é‡è¦: è®¿é—®è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼

## 4. å·¥å‚æ¨¡å¼ [#](#t234-å·¥å‚æ¨¡å¼)

### 4.1 ç®€å•å·¥å‚æ¨¡å¼ [#](#t2441-ç®€å•å·¥å‚æ¨¡å¼)

* ç®€å•å·¥å‚æ¨¡å¼æ˜¯ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹**4.1.1 ç±»å›¾[#](#t25411-ç±»å›¾)*

![](http://img.zhufengpeixun.cn/simplefatory2.png)
**  4.1.2 ä»£ç  [#](#t26412-ä»£ç )**

```js
abstract class Coffee {
    constructor(public name: string) {

    }
}
class AmericanoCoffee extends Coffee {
    constructor(public name: string) {
        super(name);
    }
}
class LatteCoffee extends Coffee {
    constructor(public name: string) {
        super(name);
    }
}
class CappuccinoCoffee extends Coffee {
    constructor(public name: string) {
        super(name);
    }
}

class CafÃ© {
    static order(name: string) {
        switch (name) {
            case 'Americano':
                return new AmericanoCoffee('ç¾å¼å’–å•¡');
            case 'Latte':
                return new LatteCoffee('æ‹¿é“å’–å•¡');
            case 'Cappuccino':
                return new LatteCoffee('å¡å¸ƒå¥‡è¯º');
            default:
                return null;
        }
    }
}
console.log(CafÃ©.order('Americano'));
console.log(CafÃ©.order('Latte'));
console.log(CafÃ©.order('Cappuccino'));

```

### 4.1.3 ç¼ºç‚¹ [#](#t27413-ç¼ºç‚¹)

* å¦‚æœäº§å“çš„ç§ç±»éå¸¸å¤š `switch case`çš„åˆ¤æ–­ä¼šå˜å¾—éå¸¸å¤š
* ä¸ç¬¦åˆå¼€æ”¾â€”å°é—­åŸåˆ™,å¦‚æœè¦å¢åŠ æˆ–åˆ é™¤ä¸€ä¸ªäº§å“ç§ç±»ï¼Œå°±è¦ä¿®æ”¹ `switch case`çš„åˆ¤æ–­ä»£ç 

**  4.1.3 å‰ç«¯åº”ç”¨åœºæ™¯ [#](#t28413-å‰ç«¯åº”ç”¨åœºæ™¯)**

##### 4.1.3.1 jQuery [#](#t294131-jquery)

* [jQuery](https://github.com/jquery/jquery/blob/c1ee33aded44051b8f1288b59d2efdc68d0413cc/src/core.js#L24-L29)

```js
class jQuery{
    constructor(selector){
        let elements = Array.from(document.querySelectorAll(selector));
        let length = elements?elements.length:0;
        for(let i=0;ithis[i]=elements[i];
        }
        this.length = length;
    }
    html(html){
        if(html){
           this[0].innerHTML=html;
        }else{
          return this[0].innerHTML;
        }
    }
}
window.$ = function(selector){
   return new jQuery(selector);
}
```

##### 4.1.3.2 React [#](#t304132-react)

* [createElement](https://github.com/facebook/react/blob/master/packages/react/src/ReactElement.js#L313-L395)

```js
export function createElement(type, config, children) {
    return ReactElement(
        type,
        key,
        ref,
        self,
        source,
        ReactCurrentOwner.current,
        props,
    );
}
```

### 4.2 å·¥å‚æ–¹æ³•æ¨¡å¼ [#](#t3142-å·¥å‚æ–¹æ³•æ¨¡å¼)

* å·¥å‚æ–¹æ³•æ¨¡å¼ `Factory Method`,åˆç§°å¤šæ€æ€§å·¥å‚æ¨¡å¼ã€‚
* åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­,æ ¸å¿ƒçš„å·¥å‚ç±»ä¸å†è´Ÿè´£æ‰€æœ‰çš„äº§å“çš„åˆ›å»ºï¼Œè€Œæ˜¯å°†å…·ä½“åˆ›å»ºçš„å·¥ä½œäº¤ç»™å·¥å‚å­ç±»å»åšã€‚

**  4.2.1 ç±»å›¾ [#](#t32421-ç±»å›¾)**

![](http://img.zhufengpeixun.cn/factorymethod.png)
**  4.2.2 ä»£ç  [#](#t33422-ä»£ç )**

```js
export { }
abstract class Coffee {
    constructor(public name: string) {

    }
}
abstract class Factory {
    abstract createCoffee(): Coffee;
}
class AmericanoCoffee extends Coffee {
    constructor(public name: string) {
        super(name);
    }
}

class AmericanoCoffeeFactory extends Factory {
    createCoffee() {
        return new AmericanoCoffee('ç¾å¼å’–å•¡')
    }
}

class LatteCoffee extends Coffee {
    constructor(public name: string) {
        super(name);
    }
}
class LatteCoffeeFactory extends Factory {
    createCoffee() {
        return new LatteCoffee('æ‹¿é“å’–å•¡')
    }
}
class CappuccinoCoffee extends Coffee {
    constructor(public name: string) {
        super(name);
    }
}
class CappuccinoFactory extends Factory {
    createCoffee() {
        return new CappuccinoCoffee('å¡å¸ƒå¥‡è¯º')
    }
}
class CafÃ© {
    static order(name: string) {
        switch (name) {
            case 'Americano':
                return new AmericanoCoffeeFactory().createCoffee();
            case 'Latte':
                return new LatteCoffeeFactory().createCoffee();
            case 'Cappuccino':
                return new CappuccinoFactory().createCoffee();
            default:
                return null;
        }
    }
}
console.log(CafÃ©.order('Americano'));
console.log(CafÃ©.order('Latte'));
console.log(CafÃ©.order('Cappuccino'));
```

**  4.2.3 åº”ç”¨åœºæ™¯ [#](#t34423-åº”ç”¨åœºæ™¯)**

##### 4.2.3.1 React [#](#t354231-react)

* [createFactory](https://github.com/facebook/react/blob/master/packages/react/src/ReactElement.js#L401-L409)

### 4.3 æŠ½è±¡å·¥å‚æ¨¡å¼ [#](#t3643-æŠ½è±¡å·¥å‚æ¨¡å¼)

* æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥å‘å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œä½¿å®¢æˆ·ç«¯åœ¨ä¸å¿…æŒ‡å®šäº§å“çš„å…·ä½“çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºå¤šä¸ªäº§å“æ—ä¸­çš„äº§å“å¯¹è±¡
* å·¥å‚æ–¹æ³•æ¨¡å¼é’ˆå¯¹çš„æ˜¯åŒä¸€ç±»æˆ–åŒç­‰çº§äº§å“,è€ŒæŠ½è±¡å·¥å‚æ¨¡å¼é’ˆå¯¹çš„æ˜¯å¤šç§ç±»çš„äº§å“è®¾è®¡
* ç³»ç»Ÿä¸­æœ‰å¤šä¸ªäº§å“æ—ï¼Œæ¯ä¸ªå…·ä½“å·¥å‚è´Ÿè´£åˆ›å»ºåŒä¸€æ—ä½†å±äºä¸åŒäº§å“ç­‰çº§(äº§å“ç§ç±»)çš„äº§å“
* äº§å“æ—æ˜¯ä¸€ç»„ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡
* ç³»ç»Ÿä¸€æ¬¡åªèƒ½æ¶ˆè´¹æŸä¸€æ—äº§å“ï¼Œå³ç›¸åŒäº§å“æ—çš„äº§å“æ˜¯ä¸€èµ·è¢«ä½¿ç”¨çš„
* å½“ç³»ç»Ÿéœ€è¦æ–°å¢ä¸€ä¸ªäº§å“æ—æ—¶ï¼Œåªéœ€è¦å¢åŠ æ–°çš„å·¥å‚ç±»å³å¯ï¼Œæ— éœ€ä¿®æ”¹æºä»£ç ï¼›ä½†æ˜¯å¦‚æœéœ€è¦äº§å“æ—ä¸­å¢åŠ ä¸€ä¸ªæ–°ç§ç±»çš„äº§å“æ—¶ï¼Œåˆ™æ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦ä¿®æ”¹

**  4.3.1 ç»„æˆè§’è‰² [#](#t37431-ç»„æˆè§’è‰²)**

* æŠ½è±¡å·¥å‚: æä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£,åŒ…å«å¤šä¸ªåˆ›å»ºäº§å“çš„æ–¹æ³•,å³åŒ…å«å¤šä¸ªç±»ä¼¼åˆ›å»ºäº§å“çš„æ–¹æ³•
* å…·ä½“å·¥å‚: å®ç°æŠ½è±¡å·¥å‚å®šä¹‰çš„æ¥å£,å®ŒæˆæŸä¸ªå…·ä½“äº§å“çš„åˆ›å»º
* æŠ½è±¡äº§å“: æŠ½è±¡äº§å“å®šä¹‰,ä¸€èˆ¬æœ‰å¤šå°‘æŠ½è±¡äº§å“,æŠ½è±¡å·¥å‚ä¸­å°±åŒ…å«å¤šå°‘ä¸ªåˆ›å»ºäº§å“çš„æ–¹æ³•
* å…·ä½“äº§å“: æŠ½è±¡äº§å“çš„å®ç°ç±»

**  4.3.1 ç±»å›¾ [#](#t38431-ç±»å›¾)**

![](http://img.zhufengpeixun.cn/abstractfactory3.png)

![](http://img.zhufengpeixun.cn/abstractfactory2.png)
**  4.3.2 ä»£ç  [#](#t39432-ä»£ç )**

```js
export { };
abstract class AmericanoCoffee { }
abstract class LatteCoffee { }
abstract class CappuccinoCoffee { }

class StarbucksAmericanoCoffee extends AmericanoCoffee { }
class StarbucksLatteCoffee extends LatteCoffee { }
class StarbucksCappuccinoCoffee extends CappuccinoCoffee { }

class LuckinAmericanoCoffee extends AmericanoCoffee { }
class LuckinLatteCoffee extends LatteCoffee { }
class LuckinCappuccinoCoffee extends CappuccinoCoffee { }

abstract class CafeFactory {
    abstract createAmericanoCoffee(): AmericanoCoffee;
    abstract createLatteCoffee(): LatteCoffee;
    abstract createCappuccinoCoffee(): CappuccinoCoffee;
}
class StarbucksCafeFactory extends CafeFactory {
    createAmericanoCoffee() {
        return new StarbucksAmericanoCoffee();
    }
    createLatteCoffee() {
        return new StarbucksLatteCoffee();
    }
    createCappuccinoCoffee() {
        return new StarbucksCappuccinoCoffee();
    }
}
class LuckinCafeFactory extends CafeFactory {
    createAmericanoCoffee() {
        return new LuckinAmericanoCoffee();
    }
    createLatteCoffee() {
        return new LuckinLatteCoffee();
    }
    createCappuccinoCoffee() {
        return new LuckinCappuccinoCoffee();
    }
}

let starbucksCafeFactory = new StarbucksCafeFactory();
console.log(starbucksCafeFactory.createAmericanoCoffee());
console.log(starbucksCafeFactory.createCappuccinoCoffee());
console.log(starbucksCafeFactory.createLatteCoffee());

let luckinCafeFactory = new LuckinCafeFactory();
console.log(luckinCafeFactory.createAmericanoCoffee());
console.log(luckinCafeFactory.createCappuccinoCoffee());
console.log(luckinCafeFactory.createLatteCoffee());
```

## 5.å•ä¾‹æ¨¡å¼ [#](#t405å•ä¾‹æ¨¡å¼)

**  5.1 ç±»å›¾ [#](#t4151-ç±»å›¾)**

![](http://img.zhufengpeixun.cn/singleobject.jpg)
**  5.2 ä»£ç  [#](#t4252-ä»£ç )**

##### 5.2.1 å•ä¾‹æ¨¡å¼ [#](#t43521-å•ä¾‹æ¨¡å¼)

```js
export { };
class Window {
    private static instance: Window;
    private constructor() { }
    static getInstance() {
        if (!Window.instance) {
            Window.instance = new Window();
        }
        return Window.instance;
    }
}

var w1 = Window.getInstance();
var w2 = Window.getInstance();
console.log(w1 === w2);
```

##### 5.2.2 ES5å•ä¾‹æ¨¡å¼ [#](#t44522-es5å•ä¾‹æ¨¡å¼)

```js
interface Window {
    hello: any
}
function Window() { }
Window.prototype.hello = function () {
    console.log('hello');
}
Window.getInstance = (function () {
    let window: Window;
    return function () {
        if (!window)
            window = new (Window as any)();
        return window;
    }
})();
let window = Window.getInstance();
window.hello();
```

##### 5.2.3 é€æ˜å•ä¾‹ [#](#t45523-é€æ˜å•ä¾‹)

```js
let Window = (function () {
    let window: Window;
    let Window = function (this: Window) {
        if (window) {
            return window;
        } else {
            return (window = this);
        }
    }
    Window.prototype.hello = function () {
        console.log('hello');
    }
    return Window;
})();

let window1 = new (Window as any)();
let window2 = new (Window as any)();
window1.hello();
console.log(window1 === window2)
```

##### 5.2.4 å•ä¾‹ä¸æ„å»ºåˆ†ç¦» [#](#t46524-å•ä¾‹ä¸æ„å»ºåˆ†ç¦»)

```js
export { }
interface Window {
    hello: any
}
function Window() {
}
Window.prototype.hello = function () {
    console.log('hello');
}

let createInstance = (function () {
    let instance: Window;
    return function () {
        if (!instance) {
            instance = new (Window as any)();
        }
        return instance;
    }
})();

let window1 = createInstance();
let window2 = createInstance();
window1.hello();
console.log(window1 === window2)
```

##### 5.2.5 å°è£…å˜åŒ– [#](#t47525-å°è£…å˜åŒ–)

```js
export { }
function Window() {

}
Window.prototype.hello = function () {
    console.log('hello');
}

let createInstance = function (Constructor: any) {
    let instance: any;
    return function (this: any) {
        if (!instance) {
            Constructor.apply(this, arguments);
            Object.setPrototypeOf(this, Constructor.prototype)
            instance = this;
        }
        return instance;
    }
};
let CreateWindow: any = createInstance(Window);
let window1 = new CreateWindow();
let window2 = new CreateWindow();
window1.hello();
console.log(window1 === window2)
```

**  5.3 åœºæ™¯ [#](#t4853-åœºæ™¯)**

##### 5.3.2 commonjs [#](#t49532-commonjs)

* [HotModuleReplacement](https://github.com/webpack/webpack/blob/8070bcd333cd1d07ce13fe5e91530c80779d51c6/lib/hmr/HotModuleReplacement.runtime.js#L55)

```js
(function(modules) {

  var installedModules = {};

  function __webpack_require__(moduleId) {

    if (installedModules[moduleId]) {
      return installedModules[moduleId].exports;
    }

    var module = (installedModules[moduleId] = {
      i: moduleId,
      l: false,
      exports: {}
    });

    modules[moduleId].call(
      module.exports,
      module,
      module.exports,
      __webpack_require__
    );

    module.l = true;

    return module.exports;
  }
}
```

##### 5.3.2 jQuery [#](#t50532-jquery)

* [jquery](https://code.jquery.com/jquery-3.4.1.js)

```js
if(window.jQuery!=null){
  return window.jQuery;
}else{

}
```

##### 5.3.3 æ¨¡æ€çª—å£ [#](#t51533-æ¨¡æ€çª—å£)

* [bootstrap modal.js](https://github.com/twbs/bootstrap/blob/master/js/src/modal.js)

```js

    Document

    æ˜¾ç¤ºæ¨¡æ€çª—å£
    éšè—æ¨¡æ€çª—å£

        class Login {
            constructor() {
                this.element = document.createElement('div');
                this.element.innerHTML = (
                    `
            ç”¨æˆ·å <input type="text"/>
            <button>ç™»å½•</button>
            `
                );
                this.element.style.cssText = 'width: 100px; height: 100px; position: absolute; left: 50%; top: 50%; display: block;';
                document.body.appendChild(this.element);
            }
            show() {
                this.element.style.display = 'block';
            }
            hide() {
                this.element.style.display = 'none';
            }
        }
        Login.getInstance = (function () {
            let instance;
            return function () {
                if (!instance) {
                    instance = new Login();
                }
                return instance;
            }
        })();

        document.getElementById('show-button').addEventListener('click', function (event) {
            Login.getInstance().show();
        });
        document.getElementById('hide-button').addEventListener('click', function (event) {
            Login.getInstance().hide();
        });

```

##### 5.3.4 store [#](#t52534-store)

* [createStore.ts](https://github.com/reduxjs/redux/blob/master/src/createStore.ts)

```js
function createStore(reducer: any) {
    let state: any;
    let listeners: any[] = [];
    function getState() {
        return state;
    }
    function dispatch(action: any) {
        state = reducer(state, action);
        listeners.forEach(l => l());
    }
    function subscribe(listener: any) {
        listeners.push(listener);
        return () => {
            listeners = listeners.filter(item => item != listener);
            console.log(listeners);
        }
    }
    dispatch({});
    return {
        getState,
        dispatch,
        subscribe
    }
}
let store = createStore((state: any, action: any) => state);
```

##### 5.3.5 ç¼“å­˜ [#](#t53535-ç¼“å­˜)

```js
let express = require('express');
let fs = require('fs');
let cache: Record = {};
let app = express();
app.get('/user/:id', function (req: any, res: any) {
    let id = req.params.id;
    let user = cache.get(id);
    if (user) {
        res.json(user);
    } else {
        fs.readFile(`./users/${id}.json`, 'utf8', function (err: any, data: any) {
            let user = JSON.parse(data);
            cache.put(id, user);
            res.json(user);
        });
    }
});
app.listen(3000);
```

## 6. é€‚é…å™¨æ¨¡å¼ [#](#t546-é€‚é…å™¨æ¨¡å¼)

* é€‚é…å™¨æ¨¡å¼åˆç§°åŒ…è£…å™¨æ¨¡å¼,å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬åŒ–ä¸ºç”¨æˆ·éœ€è¦çš„å¦ä¸€ä¸ªæ¥å£,è§£å†³ç±»(å¯¹è±¡)ä¹‹é—´æ¥å£ä¸å…¼å®¹çš„é—®é¢˜
* æ—§çš„æ¥å£å’Œä½¿ç”¨è€…ä¸å…¼å®¹
* ä¸­é—´åŠ ä¸€ä¸ªé€‚é…å™¨è½¬æ¢æ¥å£

![](http://img.zhufengpeixun.cn/myadapor.jpg)
**  6.1 ç±»å›¾ [#](#t5561-ç±»å›¾)**

![](http://img.zhufengpeixun.cn/poweradaptor4.png)

![](http://img.zhufengpeixun.cn/myadapters.png)
**  6.2 ä»£ç  [#](#t5662-ä»£ç )**

```js
class Socket {
    output() {
        return 'è¾“å‡º220V';
    }
}

abstract class Power {
    abstract charge(): string;
}
class PowerAdapter extends Power {
    constructor(public socket: Socket) {
        super();
    }

    charge() {
        return this.socket.output() + ' ç»è¿‡è½¬æ¢ è¾“å‡º24V';
    }
}
let powerAdapter = new PowerAdapter(new Socket());
console.log(powerAdapter.charge());
```

**  6.3 åœºæ™¯ [#](#t5763-åœºæ™¯)**

##### 6.2.1 axios [#](#t58621-axios)

* [Axios](https://github.com/axios/axios/blob/master/lib/core/Axios.js#L6)
* [dispatchRequest](https://github.com/axios/axios/blob/master/lib/core/dispatchRequest.js#L50-L79)
* [defaults](https://github.com/axios/axios/blob/master/lib/defaults.js#L16-L26)
* [xhr](https://github.com/axios/axios/blob/dc4bc49673943e35280e5df831f5c3d0347a9393/lib/adapters/xhr.js)
* [http](https://github.com/axios/axios/blob/dc4bc49673943e35280e5df831f5c3d0347a9393/lib/adapters/http.js)
* é€‚é…å™¨çš„å…¥å‚éƒ½æ˜¯ `config`,è¿”å›çš„éƒ½æ˜¯ `promise`

```js

let url = require('url');
function axios(config: any): any {
    let adaptor = getDefaultAdapter();
    return adaptor(config);
}
axios({
    method: 'GET',
    url: 'http://localhost:8080/api/user?id=1'
}).then(function (response: any) {
    console.log(response);
}, function (error: any) {
    console.log(error);
})

function xhr(config: any) {
    return new Promise(function (resolve, reject) {
        var request = new XMLHttpRequest();
        request.open(config.method, config.url, true);
        request.onreadystatechange = function () {
            if (request.readyState == 4) {
                if (request.status == 200) {
                    resolve(request.response);
                } else {
                    reject('è¯·æ±‚å¤±è´¥');
                }
            }
        }
    })
}
function http(config: any) {
    let http = require('http');
    let urlObject = url.parse(config.url);
    return new Promise(function (resolve, reject) {
        const options = {
            hostname: urlObject.hostname,
            port: urlObject.port,
            path: urlObject.pathname,
            method: config.method
        };
        var req = http.request(options, function (res: any) {
            let chunks: any[] = [];
            res.on('data', (chunk: any) => {
                chunks.push(chunk);
            });
            res.on('end', () => {
                resolve(Buffer.concat(chunks).toString());
            });
        });
        req.on('error', (err: any) => {
            reject(err);
        });
        req.end();
    })
}
function getDefaultAdapter(): any {
    var adapter;
    if (typeof XMLHttpRequest !== 'undefined') {
        adapter = xhr;
    } else if (typeof process !== 'undefined') {
        adapter = http;
    }
    return adapter;
}
```

server.js

```js
let express = require('express');
let app = express();
app.get('/api/user', (req, res) => {
    res.json({ id: req.query.id, name: 'zhufeng' });
});
app.listen(8080);
```

##### 6.2.2 toAxiosAdapter [#](#t59622-toaxiosadapter)

```js
function toAxiosAdapter(options: any) {
    return axios({
        url: options.url,
        method: options.type
    }).then(options.success)
        .catch(options.error)
}

$.ajax = function (options: any) {
    return toAxiosAdapter(options)
}

$.ajax({
    url: '/api/user',
    type: 'GET',
    success: function (data: any) {
        console.log(data)
    },
    error: function (err: any) {
        console.error(err);
    }
})
```

##### 6.2.3 promisify [#](#t60623-promisify)

```js
let fs = require('fs');
var Bluebird = require("bluebird");
let readFile = Bluebird.promisify(fs.readFile);

(async function () {
    let content = await readFile('./1.txt', 'utf8');
    console.log(content);
})()
```

```js
function promisify(readFile: any) {
    return function (filename: any, encoding: any) {
        return new Promise(function (resolve, reject) {
            readFile(filename, encoding, function (err: any, data: any) {
                if (err)
                    reject(err);
                else
                    resolve(data);
            })
        });
    }
}
```

##### 6.2.4 computed [#](#t61624-computed)

```js

    vue

{{name}}
{{upperName}}

let vm=new Vue({
    el: '#root',
    data: {
        name:'zfpx'
    },
    computed: {
        upperName() {
            return this.name.toUpperCase();
        }
    }
});

```

##### 6.2.5 tree [#](#t62625-tree)

* æ ‘å‹ç»“æ„æ•°æ®åœ¨ä¸‹æ‹‰æ¡†ä¸­æ˜¾ç¤º

```js

    Document

        let tree = [{
            name: 'çˆ¶äº²',
            key: '1',
            children: [
                {
                    name: 'å„¿å­',
                    key: '1-1',
                    children: [
                        {
                            name: 'å­™å­',
                            key: '1-1-1'
                        }
                    ]
                }
            ]
        }]
        function flattenAdapter(tree, flattenArray) {
            tree.forEach((item) => {
                if (item.children) {
                    flattenAdapter(item.children, flattenArray)
                }
                flattenArray.push({ name: item.name, key: item.key })
            })
            return flattenArray
        }
        let array = [];
        flattenAdapter(tree, array);
        array.reverse();
        let users = document.getElementById('users');
        let options = array.map(item => `<option value="${item.key}">${item.name}</option>`).join('');
        users.innerHTML = options;

```

##### 6.2.6 Sequelize [#](#t63626-sequelize)

* [sequelize](https://github.com/demopark/sequelize-docs-Zh-CN/tree/master)

```js

const { Sequelize, Model, DataTypes } = require('sequelize');
const sequelize = new Sequelize('sqlite::memory:');

class User extends Model { }
User.init({
    username: DataTypes.STRING
}, { sequelize, modelName: 'user' });

sequelize.sync()
    .then(() => User.create({
        username: 'zhufeng'
    }))
    .then(result => {
        console.log(result.toJSON());
    });
```

## 7.è£…é¥°å™¨æ¨¡å¼ [#](#t647è£…é¥°å™¨æ¨¡å¼)

* åœ¨ä¸æ”¹å˜å…¶åŸæœ‰çš„ç»“æ„å’ŒåŠŸèƒ½ä¸ºå¯¹è±¡æ·»åŠ æ–°åŠŸèƒ½çš„æ¨¡å¼å…¶å®å°±å«åšè£…é¥°å™¨æ¨¡å¼
* æœ€ç›´è§‚åœ°å°±æ˜¯æˆ‘ä»¬ä¹°æˆ¿åçš„è£…ä¿®
* è£…é¥°æ¯”ç»§æ‰¿æ›´åŠ çµæ´»,å¯ä»¥å®ç°è£…é¥°è€…å’Œè¢«è£…é¥°è€…ä¹‹é—´æ¾è€¦åˆ
* è¢«è£…é¥°è€…å¯ä»¥ä½¿ç”¨è£…é¥°è€…åŠ¨æ€åœ°å¢åŠ å’Œæ’¤é”€åŠŸèƒ½

**  7.1 ç±»å›¾ [#](#t6571-ç±»å›¾)**

![](http://img.zhufengpeixun.cn/shapedecorator.png)
**  7.2 ä»£ç  [#](#t6672-ä»£ç )**

```js

abstract class Shape {
    abstract draw(): void;
}
class Circle extends Shape {
    draw() {
        console.log('ç»˜åˆ¶åœ†å½¢');
    }
}
class Rectangle extends Shape {
    draw() {
        console.log('ç»˜åˆ¶çŸ©å½¢');
    }
}

abstract class ColorfulShape extends Shape {
    public constructor(public shape: Shape) {
        super();
    }
    abstract draw(): void;
}

class RedColorfulShape extends ColorfulShape {
    draw() {
        this.shape.draw();
        console.log('æŠŠè¾¹æ¡†æ¶‚æˆçº¢è‰²');
    }
}
class GreenColorfulShape extends ColorfulShape {
    draw() {
        this.shape.draw();
        console.log('æŠŠè¾¹æ¡†æ¶‚æˆç»¿è‰²');
    }
}

let circle = new Circle();
let redColorfulShape = new RedColorfulShape(circle);
redColorfulShape.draw();

let rectangle = new Rectangle();
let greenColorfulShape = new GreenColorfulShape(rectangle);
greenColorfulShape.draw();
```

**  7.3 åº”ç”¨åœºæ™¯ [#](#t6773-åº”ç”¨åœºæ™¯)**

##### 7.3.1 è£…é¥°å™¨ [#](#t68731-è£…é¥°å™¨)

* è£…é¥°å™¨æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å£°æ˜ï¼Œå®ƒèƒ½å¤Ÿè¢«é™„åŠ åˆ°ç±»å£°æ˜ã€æ–¹æ³•ã€å±æ€§æˆ–å‚æ•°ä¸Šï¼Œå¯ä»¥ä¿®æ”¹ç±»çš„è¡Œä¸º
* å¸¸è§çš„è£…é¥°å™¨æœ‰ç±»è£…é¥°å™¨ã€å±æ€§è£…é¥°å™¨ã€æ–¹æ³•è£…é¥°å™¨å’Œå‚æ•°è£…é¥°å™¨
* è£…é¥°å™¨çš„å†™æ³•åˆ†ä¸ºæ™®é€šè£…é¥°å™¨å’Œè£…é¥°å™¨å·¥å‚

###### 7.3.1.1 ç±»è£…é¥°å™¨ [#](#t697311-ç±»è£…é¥°å™¨)

* ç±»è£…é¥°å™¨åœ¨ç±»å£°æ˜ä¹‹å‰å£°æ˜ï¼Œç”¨æ¥ç›‘æ§ã€ä¿®æ”¹æˆ–æ›¿æ¢ç±»å®šä¹‰
* å‚æ•°æ˜¯ç±»çš„å®šä¹‰æˆ–è€…è¯´æ„é€ å‡½æ•°
* [babel-plugin-proposal-decorators](https://babeljs.io/docs/en/babel-plugin-proposal-decorators)

decorator

```js
export { }
namespace decorator {
    interface Animal {
        swings: string;
        fly: any
    }
    function flyable(target: any) {
        console.log(target);

        target.prototype.swings = 2;
        target.prototype.fly = function () {
            console.log('I can fly');
        }
    }
    @flyable
    class Animal {
        constructor() { }
    }
    let animal: Animal = new Animal();
    console.log(animal.swings);
    animal.fly();
}
```

decorator_factory

```js
namespace decorator_factory {
    interface Animal {
        swings: string;
        fly: any
    }
    function flyable(swings: number) {
        return function flyable(target: any) {
            console.log(target);

            target.prototype.swings = swings;
            target.prototype.fly = function () {
                console.log('I can fly');
            }
        }
    }

    @flyable(2)
    class Animal {
        constructor() { }
    }
    let animal: Animal = new Animal();
    console.log(animal.swings);
    animal.fly();
}
```

###### 7.3.1.2 å±æ€§è£…é¥°å™¨ [#](#t707312-å±æ€§è£…é¥°å™¨)

* å±æ€§è£…é¥°å™¨è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶å½“ä½œå‡½æ•°è¢«è°ƒç”¨
* å±æ€§åˆ†ä¸ºå®ä¾‹å±æ€§å’Œç±»å±æ€§
* æ–¹æ³•åˆ†ä¸ºå®ä¾‹æ–¹æ³•å’Œç±»æ–¹æ³•

```js
namespace property_namespace {

    function instancePropertyDecorator(target: any, key: string) {
    }

    function classPropertyDecorator(target: any, key: string) {
    }

    function instanceMethodDecorator(target: any, key: string, descriptor: PropertyDescriptor) {
    }

    function classMethodDecorator(target: any, key: string, descriptor: PropertyDescriptor) {
    }
    class Person {
        @instancePropertyDecorator
        instanceProperty: string;
        @classPropertyDecorator
        public static classProperty: string;
        @instanceMethodDecorator
        instanceMethod() {
            console.log('instanceMethod');
        }
        @classMethodDecorator
        classMethod() {
            console.log('classMethod');
        }
    }
}
```

###### 7.3.1.3 core-decorator [#](#t717313-core-decorator)

* [core-decorator](https://github.com/jayphelps/core-decorators)
* [deprecate-alias-deprecated](https://github.com/jayphelps/core-decorators#deprecate-alias-deprecated)

```js
let { readonly } = require('core-decorators');
function deprecate(msg: string, options: any) {
    return function (target: any, attr: any, descriptor: any) {

        let oldVal = descriptor.value;
        descriptor.value = function (...args: any[]) {
            let message = msg ? msg : `DEPRECATION ${target.constructor.name}#${attr}: This function will be removed in future versions.`;
            let see = options && options.url ? `see ${options.url}` : ``;
            console.warn(message + '\r\n' + see);
            return oldVal(...args);
        }
    }
}
class Calculator {
    @deprecate('stop using this', { url: 'http://www.baidu.com' })
    add(a: number, b: number) {
        return a + b;
    }
}
let calculator = new Calculator();
calculator.add(1, 2);
```

##### 7.3.2 AOPæ¦‚å¿µ [#](#t72732-aopæ¦‚å¿µ)

* åœ¨è½¯ä»¶ä¸šï¼ŒAOPä¸º `Aspect Oriented Programming`çš„ç¼©å†™,æ„ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹
* å¯ä»¥é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ç»™ç¨‹åºåŠ¨æ€ç»Ÿä¸€æ·»åŠ åŠŸèƒ½çš„ä¸€ç§æŠ€æœ¯

![](http://img.zhufengpeixun.cn/springaop2.jpeg)

![](http://img.zhufengpeixun.cn/apoprogram.jpg)

##### 7.3.3 åŸ‹ç‚¹ [#](#t73733-åŸ‹ç‚¹)

* åŸ‹ç‚¹åˆ†æ: æ˜¯ç½‘ç«™åˆ†æçš„ä¸€ç§å¸¸ç”¨çš„æ•°æ®é‡‡é›†æ–¹æ³•
* æ— ç—•åŸ‹ç‚¹: é€šè¿‡æŠ€æœ¯æ‰‹æ®µï¼Œå®Œæˆå¯¹ç”¨æˆ·è¡Œä¸ºæ•°æ®æ— å·®åˆ«çš„ç»Ÿè®¡ä¸Šä¼ çš„å·¥ä½œ,åæœŸæ•°æ®åˆ†æå¤„ç†çš„æ—¶å€™é€šè¿‡æŠ€æœ¯æ‰‹æ®µç­›é€‰å‡ºåˆé€‚çš„æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ

###### 7.3.3.1 é¡¹ç›®é…ç½® [#](#t747331-é¡¹ç›®é…ç½®)

1. åˆ›å»ºé¡¹ç›®

```js
create-react-app zhufeng_tract
yarn add customize-cra react-app-rewired --dev
```

1. config-overrides.js

```js
const {
 override,
 addDecoratorsLegacy,
} = require("customize-cra");
module.exports = override(
 addDecoratorsLegacy(),
);
```
2. jsconfig.json

```js
{
 "compilerOptions": {
     "experimentalDecorators": true
 }
}
```

###### 7.3.3.2 index.js [#](#t757332-indexjs)

```js
import React from 'react';
import { render } from 'react-dom';
import { before, after } from './track';

class App extends React.Component {
    @before(() => console.log('ç‚¹å‡»æ–¹æ³•æ‰§è¡Œå‰'))
    onClickBeforeButton() {
        console.log('beforeClick');
    }

    @after(() => console.log('ç‚¹å‡»æ–¹æ³•æ‰§è¡Œå'))
    onClickAfterButton() {
        console.log('afterClick');
    }

    @after(() => fetch('/api/report'))
    onClickAjaxButton() {
        console.log('ajaxClick');
    }

    render() {
        return (
            <div>
                <button onClick={this.onClickBeforeButton}>beforeClickbutton>
                <button onClick={this.onClickAfterButton}>afterClickbutton>
                <button onClick={this.onClickAjaxButton}>ajaxClickbutton>
            div>
        )
    }
}
render(<App />, document.getElementById('root'));
```

###### 7.3.3.3 track.js [#](#t767333-trackjs)

```js
export const before = function (beforeFn) {
    return function (target, methodName, descriptor) {
        let oldMethod = descriptor.value;
        descriptor.value = function () {
            beforeFn.apply(this, arguments);
            return oldMethod.apply(this, arguments);
        }
    }
}

export const after = function (afterFn) {
    return function (target, methodName, descriptor) {
        let oldMethod = descriptor.value;
        descriptor.value = function () {
            oldMethod.apply(this, arguments);
            afterFn.apply(this, arguments);
        }
    }
}
```

##### 7.3.4 è¡¨å•æ ¡éªŒ [#](#t77734-è¡¨å•æ ¡éªŒ)

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ç”¨æˆ·æ³¨å†Œtitle>
head>

<body>
    <form action="">
        ç”¨æˆ·å<input type="text" name="username" id="username">
        å¯†ç <input type="text" name="password" id="password">
        <button id="submit-btn">æ³¨å†Œbutton>
    form>
    <script>
        Function.prototype.before = function (beforeFn) {
            let _this = this;
            return function () {
                let ret = beforeFn.apply(this, arguments);
                if (ret)
                    _this.apply(this, arguments);
            }
        }
        function submit() {
            alert('æäº¤è¡¨å•');
        }
        submit = submit.before(function () {
            let username = document.getElementById('username').value;
            if (username.length < 6) {
                return alert('ç”¨æˆ·åä¸èƒ½å°‘äº6ä½');
            }
            return true;
        });
        submit = submit.before(function () {
            let username = document.getElementById('username').value;
            if (!username) {
                return alert('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
            }
            return true;
        });
        document.getElementById('submit-btn').addEventListener('click', submit);
    script>
body>
html>
```

## 8.ä»£ç†æ¨¡å¼ [#](#t788ä»£ç†æ¨¡å¼)

* ç”±äºä¸€ä¸ªå¯¹è±¡ä¸èƒ½ç›´æ¥å¼•ç”¨å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ä»£ç†å¯¹è±¡åœ¨è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹ä½œç”¨
* ä»£ç†æ¨¡å¼å°±æ˜¯ä¸ºç›®æ ‡å¯¹è±¡åˆ›é€ ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä»¥å®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®
* è¿™æ ·å°±å¯ä»¥åœ¨ä»£ç†å¯¹è±¡é‡Œå¢åŠ ä¸€äº›é€»è¾‘åˆ¤æ–­ã€è°ƒç”¨å‰æˆ–è°ƒç”¨åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œä»è€Œå®ç°äº†æ‰©å±•ç›®æ ‡çš„åŠŸèƒ½
* ç«è½¦ç¥¨ä»£è´­ã€æˆ¿äº§ä¸­ä»‹ã€å¾‹å¸ˆã€æµ·å¤–ä»£è´­ã€æ˜æ˜Ÿç»çºªäºº

**  8.1 ç±»å›¾ [#](#t7981-ç±»å›¾)**

* Target ç›®æ ‡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ï¼Œæ˜¯å…·ä½“ä¸šåŠ¡çš„æ‰§è¡Œè€…
* Proxy ä»£ç†å¯¹è±¡ï¼Œé‡Œé¢ä¼šåŒ…å«ä¸€ä¸ªç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥å®ç°å¯¹è®¿é—®çš„æ‰©å±•å’Œé¢å¤–å¤„ç†

![](http://img.zhufengpeixun.cn/proxystar.png)
**  8.2 ä»£ç  [#](#t8082-ä»£ç )**

```js
abstract class Star {
    abstract answerPhone(): void;
}

class Angelababy extends Star {
    public available: boolean = true;
    answerPhone(): void {
        console.log('ä½ å¥½,æˆ‘æ˜¯Angelababy.');
    }
}
class AngelababyAgent extends Star {
    constructor(private angelababy: Angelababy) {
        super();
    }
    answerPhone(): void {
        console.log('ä½ å¥½,æˆ‘æ˜¯Angelababyçš„ç»çºªäºº.');
        if (this.angelababy.available) {
            this.angelababy.answerPhone();
        }
    }
}
let angelababyAgent = new AngelababyAgent(new Angelababy());
angelababyAgent.answerPhone();
```

**  8.3 åœºæ™¯ [#](#t8183-åœºæ™¯)**

##### 8.3.1 äº‹ä»¶å§”æ‰˜ä»£ç† [#](#t82831-äº‹ä»¶å§”æ‰˜ä»£ç†)

* äº‹ä»¶æ•è·æŒ‡çš„æ˜¯ä»documentåˆ°è§¦å‘äº‹ä»¶çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œå³è‡ªä¸Šè€Œä¸‹çš„å»è§¦å‘äº‹ä»¶
* äº‹ä»¶å†’æ³¡æ˜¯è‡ªä¸‹è€Œä¸Šçš„å»è§¦å‘äº‹ä»¶
* ç»‘å®šäº‹ä»¶æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ§åˆ¶äº‹ä»¶è§¦å‘é¡ºåºæ˜¯å¦ä¸ºäº‹ä»¶æ•è·ã€‚trueä¸ºäº‹ä»¶æ•è·ï¼›falseä¸ºäº‹ä»¶å†’æ³¡,é»˜è®¤falseã€‚

![](http://img.zhufengpeixun.cn/captureevent.jpg)

```js

        1
        2
        3

  let list = document.querySelector('#list');
  list.addEventListener('click',event=>{
       alert(event.target.innerHTML);
  });

```

##### 8.3.2 è™šæ‹Ÿä»£ç†(å›¾ç‰‡é¢„åŠ è½½) [#](#t83832-è™šæ‹Ÿä»£ç†å›¾ç‰‡é¢„åŠ è½½)

* [bg-images](http://img.zhufengpeixun.cn/bg-images.zip)

###### 8.3.2.1 app.js [#](#t848321-appjs)

```js
let express=require('express');
let path=require('path')
let app=express();
app.get('/images/loading.gif',function (req,res) {
    res.sendFile(path.join(__dirname,req.path));
});
app.get('/images/:name',function (req,res) {
    setTimeout(() => {
        res.sendFile(path.join(__dirname,req.path));
    }, 2000);
});
app.get('/',function (req,res) {
    res.sendFile(path.resolve('index.html'));
});
app.listen(8080);
```

###### 8.3.2.2 index.html [#](#t858322-indexhtml)

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Documenttitle>
    <style>
        .bg-container {
            width: 600px;
            height: 400px;
            margin: 100px auto;
        }

        .bg-container #bg-image {
            width: 100%;
            height: 100%;
        }
    style>
head>

<body>
    <div id="background">
        <button data-src="/images/bg1.jpg">èƒŒæ™¯1button>
        <button data-src="/images/bg2.jpg">èƒŒæ™¯2button>
    div>
    <div class="bg-container">
        <img id="bg-image" src="/images/bg1.jpg" />
    div>
    <script>
        let container = document.querySelector('#background');

        class BackgroundImage {
            constructor() {
                this.bgImage = document.querySelector('#bg-image');
            }
            setSrc(src) {
                this.bgImage.src = src;
            }
        }
        class LoadingBackgroundImage {
             static LOADING_URL= `/images/loading.gif`;
            constructor() {
                this.backgroundImage = new BackgroundImage();
            }
            setSrc(src) {
                this.backgroundImage.setSrc(LoadingBackgroundImage.LOADING_URL);
                let img = new Image();
                img.onload = () => {
                    this.backgroundImage.setSrc(src);
                }
                img.src = src;
            }
        }
        let loadingBackgroundImage = new LoadingBackgroundImage();
        container.addEventListener('click', function (event) {
            let src = event.target.dataset.src;
            loadingBackgroundImage.setSrc(src + '?ts=' + Date.now());
        });
    script>
body>

html>
```

##### 8.3.3 è™šæ‹Ÿä»£ç†(å›¾ç‰‡æ‡’åŠ è½½) [#](#t86833-è™šæ‹Ÿä»£ç†å›¾ç‰‡æ‡’åŠ è½½)

* å½“å‰å¯è§†åŒºåŸŸçš„é«˜åº¦ `window.innerHeight || document.documentElement.clientHeight`
* å…ƒç´ è·ç¦»å¯è§†åŒºåŸŸé¡¶éƒ¨çš„é«˜åº¦ `getBoundingClientRect().top`
* [getBoundingClientRect](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect)
* DOMRect å¯¹è±¡åŒ…å«äº†ä¸€ç»„ç”¨äºæè¿°è¾¹æ¡†çš„åªè¯»å±æ€§â€”â€”leftã€topã€right å’Œ bottomï¼Œå•ä½ä¸ºåƒç´ ã€‚é™¤äº† width å’Œ height å¤–çš„å±æ€§éƒ½æ˜¯ç›¸å¯¹äºè§†å£çš„å·¦ä¸Šè§’ä½ç½®è€Œè¨€çš„

###### 8.3.3.1 index.html [#](#t878331-indexhtml)

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Lazy-Loadtitle>
    <style>
        .image {
            width: 300px;
            height: 200px;
            background-color: #CCC;
        }

        .image img {
            width: 100%;
            height: 100%;
        }
    style>
head>

<body>
    <div class="image-container">
        <div class="image">
            <img data-src="/images/bg1.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg2.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg1.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg2.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg1.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg2.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg1.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg2.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg1.jpg">
        div>
        <div class="image">
            <img data-src="/images/bg2.jpg">
        div>
    div>
body>
<script>
    const imgs = document.getElementsByTagName('img');
    const clientHeight = window.innerHeight || document.documentElement.clientHeight;
    let loadedIndex = 0;
    function lazyload() {
        for (let i = loadedIndex; i < imgs.length; i++) {
            if (clientHeight - imgs[i].getBoundingClientRect().top > 0) {
                imgs[i].src = imgs[i].dataset.src;
                loadedIndex = i + 1;
            }
        }
    }
    lazyload();
    window.addEventListener('scroll', lazyload, false);
script>
html>
```

##### 8.3.4 ç¼“å­˜ä»£ç† [#](#t88834-ç¼“å­˜ä»£ç†)

* æœ‰äº›æ—¶å€™å¯ä»¥ç”¨ç©ºé—´æ¢æ—¶é—´
* ä¸€ä¸ªæ­£æ•´æ•°çš„é˜¶ä¹˜ï¼ˆfactorialï¼‰æ˜¯æ‰€æœ‰å°äºåŠç­‰äºè¯¥æ•°çš„æ­£æ•´æ•°çš„ç§¯ï¼Œå¹¶ä¸”0çš„é˜¶ä¹˜ä¸º1

```js
const factorial = function f(num) {
    if (num === 1) {
        return 1;
    } else {
        return (num * f(num - 1));
    }
}

const proxy = function (fn) {
    const cache = {};
    return function (num) {
        if (num in cache) {
            return cache[num];
        }
        return cache[num] = fn.call(this, num);
    }
}

const proxyFactorial = proxy(factorial);
console.log(proxyFactorial(5));
console.log(proxyFactorial(5));
console.log(proxyFactorial(5));
```

* æ–æ³¢é‚£å¥‘æ•°åˆ—(Fibonacci sequence)æŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š1ã€1ã€2ã€3ã€5ã€8ã€13ã€21ã€34ã€‚åœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢é‚£å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)=1,F(2)=1,F(n)=F(n-1)+F(n-2)ï¼ˆn>=3ï¼ŒnâˆˆN*ï¼‰

```js
let count = 0;
function fib(n) {
    count++;
    return n 2 ? 1 : fib(n - 1) + fib(n - 2);
}
var result = fib(10);
console.log(result, count);
```

```js
let count = 0;
const fibWithCache = (function () {
    let cache = {};
    function fib(n) {
        count++;
        if (cache[n]) {
            return cache[n];
        }
        let result = n 2 ? 1 : fib(n - 1) + fib(n - 2);
        cache[n] = result;
        return result;
    }
    return fib;
})();
var result = fibWithCache(10);
console.log(result, count);
```

##### 8.3.5 é˜²æŠ–ä»£ç† [#](#t89835-é˜²æŠ–ä»£ç†)

* é€šè¿‡é˜²æŠ–ä»£ç†ä¼˜åŒ–å¯ä»¥æŠŠå¤šæ¬¡è¯·æ±‚åˆå¹¶ä¸ºä¸€æ¬¡ï¼Œæé«˜æ€§èƒ½
* èŠ‚æµä¸é˜²æŠ–éƒ½æ˜¯ä¸ºäº†å‡å°‘é¢‘ç¹è§¦å‘äº‹ä»¶å›è°ƒ
* èŠ‚æµ(Throttle)æ˜¯åœ¨æŸæ®µæ—¶é—´å†…ä¸ç®¡è§¦å‘äº†å¤šå°‘æ¬¡å›è°ƒéƒ½åªè®¤ç¬¬ä¸€ä¸ªï¼Œå¹¶åœ¨ç¬¬ä¸€æ¬¡ç»“æŸåæ‰§è¡Œå›è°ƒ
* é˜²æŠ–(Debounce)å°±æ˜¯åœ¨æŸæ®µæ—¶é—´ä¸ç®¡è§¦å‘äº†å¤šå°‘å›è°ƒéƒ½åªçœ‹æœ€åä¸€ä¸ª

###### 8.3.5.1 èŠ‚æµ [#](#t908351-èŠ‚æµ)

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Documenttitle>
    <style>
        #container {
            width: 200px;
            height: 400px;
            border: 1px solid red;
            overflow: auto;
        }

        #container .content {
            height: 4000px;
        }
    style>
head>

<body>
    <div id="container">
        <div class="content">div>
    div>
    <script>
        function throttle(callback, interval) {
            let last;
            return function () {
                let context = this;
                let args = arguments;
                let now = Date.now();
                if (last) {
                    if (now - last >= interval) {
                        last = now;
                        callback.apply(context, args);
                    }
                } else {
                    callback.apply(context, args);
                    last = now;
                }

            }
        }
        let lastTime = Date.now();
        const throttle_scroll = throttle(() => {
            console.log('è§¦å‘äº†æ»šåŠ¨äº‹ä»¶', (Date.now() - lastTime) / 1000);
        }, 1000);
        document.getElementById('container').addEventListener('scroll', throttle_scroll);
    script>
body>

html>
```

###### 8.3.5.2 é˜²æŠ– [#](#t918352-é˜²æŠ–)

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Documenttitle>
    <style>
        #container {
            width: 200px;
            height: 400px;
            border: 1px solid red;
            overflow: auto;
        }

        #container .content {
            height: 4000px;
        }
    style>
head>

<body>
    <div id="container">
        <div class="content">div>
    div>
    <script>
        function throttle(callback, delay) {
            let timer;
            return function () {
                let context = this;
                let args = arguments;
                if (timer)
                    clearTimeout(timer);
                timer = setTimeout(() => {
                    callback.apply(context, args);
                }, delay);
            }
        }
        let lastTime = Date.now();
        const throttle_scroll = throttle(() => {
            console.log('è§¦å‘äº†æ»šåŠ¨äº‹ä»¶', (Date.now() - lastTime) / 1000);
        }, 1000);
        document.getElementById('container').addEventListener('scroll', throttle_scroll);
    script>
body>

html>
```

###### 8.3.5.3 æœªé˜²æŠ– [#](#t928353-æœªé˜²æŠ–)

```html
<body>
    <ul id="todos">
    ul>
<script>
    let todos = document.querySelector('#todos');
    window.onload = function(){
        fetch('/todos').then(res=>res.json()).then(response=>{
            todos.innerHTML = response.map(item=>`${item.id}" type="checkbox" ${item.completed?"checked":""}/>${item.text}`).join('');
        });
    }
    function toggle(id){
       fetch(`/toggle/${id}`).then(res=>res.json()).then(response=>{
            console.log('response',response);
        });
    }
    todos.addEventListener('click',function(event){
        let checkbox = event.target;
        let id = checkbox.value;
        toggle(id);
    });
script>
body>
```

app.js

```js
let express=require('express');
let app=express();
app.use(express.static(__dirname));
let todos=[
    {id: 1,text: 'a',completed: false},
    {id: 2,text: 'b',completed: false},
    {id: 3,text: 'c',completed: false},
];
app.get('/todos',function (req,res) {
    res.json(todos);
});
app.get('/toggle/:id',function (req,res) {
    let id=req.params.id;
    todos = todos.map(item => {
        if (item.id==id) {
            item.completed=!item.completed;
        }
        return item;
    });
    res.json({code:0});
});
app.listen(8080);
```

###### 8.3.5.4 é˜²æŠ– [#](#t938354-é˜²æŠ–)

todos.html

```html
<body>
    <ul id="todos">
    ul>
    <script>
    let todos = document.querySelector('#todos');
    window.onload = function(){
        fetch('/todos').then(res=>res.json()).then(response=>{
            todos.innerHTML = response.map(item=>`${item.id}" type="checkbox" ${item.completed?"checked":""}/>${item.text}`).join('');
        });
    }
    function toggle(id){
       fetch(`/toggle/${id}`).then(res=>res.json()).then(response=>{
            console.log('response',response);
        });
    }
    let LazyToggle = (function(id){
        let ids = [];
        let timer;
        return function(id){
            ids.push(id);
            if(timer){
               clearTimeout(timer);
            }
            timer = setTimeout(function(){
                toggle(ids.join(','));
                ids = null;
                clearTimeout(timer);
                timer = null;
            },2000);
        }
    })();
    todos.addEventListener('click',function(event){
        let checkbox = event.target;
        let id = checkbox.value;
        LazyToggle(id);
    });
script>
```

app.js

```js
app.get('/toggle/:ids',function (req,res) {
    let ids=req.params.ids;
    ids=ids.split(',').map(item=>parseInt(item));
    todos = todos.map(item => {
        if (ids.includes(item.id)) {
            item.completed=!item.completed;
        }
        return item;
    });
    res.json({code:0});
});
```

##### 8.3.6 ä»£ç†è·¨åŸŸ [#](#t94836-ä»£ç†è·¨åŸŸ)

###### 8.3.6.1 æ­£å‘ä»£ç†å’Œåå‘ä»£ç† [#](#t958361-æ­£å‘ä»£ç†å’Œåå‘ä»£ç†)

* æ­£å‘ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯,æœåŠ¡å™¨ç«¯çœ‹ä¸åˆ°çœŸæ­£çš„å®¢æˆ·ç«¯
* é€šè¿‡å…¬å¸ä»£ç†æœåŠ¡å™¨ä¸Šç½‘

![](http://img.zhufengpeixun.cn/positiveproxy.jpg)

* åå‘ä»£ç†çš„å¯¹è±¡çš„æœåŠ¡ç«¯,å®¢æˆ·ç«¯çœ‹ä¸åˆ°çœŸæ­£çš„æœåŠ¡ç«¯
* nginxä»£ç†åº”ç”¨æœåŠ¡å™¨

![](http://img.zhufengpeixun.cn/fanproxy.jpg)

proxy-server.js

```js
const http = require('http');
const httpProxy = require('http-proxy');

const proxy = httpProxy.createProxyServer();

let server = http.createServer(function (req, res) {

    proxy.web(req, res, {
        target: 'http://127.0.0.1:9999'
    });

    proxy.on('error', function (err) {
        console.log(err);
    });
});
server.listen(8888, '0.0.0.0');
```

real-server.js

```js
const http = require('http');
let server = http.createServer(function (req, res) {
    res.end('9999');
});
server.listen(9999, '0.0.0.0');
```

###### 8.3.6.2 ä»£ç†è·¨åŸŸ [#](#t968362-ä»£ç†è·¨åŸŸ)

* nginxä»£ç†è·¨åŸŸ
* `webpack-dev-server`ä»£ç†è·¨åŸŸ
* å®¢æˆ·ç«¯ä»£ç†è·¨åŸŸ
* å½“å‰çš„æœåŠ¡å¯åŠ¨åœ¨origin(3000ç«¯å£)ä¸Šï¼Œä½†æ˜¯è°ƒç”¨çš„æ¥å£åœ¨target(4000ç«¯å£)ä¸Š
* [postMessage](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage)æ–¹æ³•å¯ä»¥å®‰å…¨åœ°å®ç°è·¨æºé€šä¿¡
  - `otherWindow`:å…¶ä»–çª—å£çš„ä¸€ä¸ªå¼•ç”¨ message:å°†è¦å‘é€åˆ°å…¶ä»–windowçš„æ•°æ®
  - `message` å°†è¦å‘é€åˆ°å…¶ä»–windowçš„æ•°æ®
  - `targetOrigin`é€šè¿‡çª—å£çš„originå±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼Œå…¶å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²"*"ï¼ˆè¡¨ç¤ºæ— é™åˆ¶ï¼‰æˆ–è€…ä¸€ä¸ªURI

```js
otherWindow.postMessage(message, targetOrigin, [transfer]);
```

* data ä»å…¶ä»– `window`ä¸­ä¼ é€’è¿‡æ¥çš„å¯¹è±¡
* origin è°ƒç”¨ `postMessage`æ—¶æ¶ˆæ¯å‘é€æ–¹çª—å£çš„ `origin`
* source å¯¹å‘é€æ¶ˆæ¯çš„çª—å£å¯¹è±¡çš„å¼•ç”¨

```js
window.addEventListener("message", receiveMessage, false);
```

origin.js

```js
let express=require('express');
let app=express();
app.use(express.static(__dirname));
app.listen(3000);
```

target.js

```js
let express = require('express');
let app = express();
let bodyParser = require('body-parser');
app.use(bodyParser.urlencoded({ extended: true }));
app.use(express.static(__dirname));
let users = [];
app.post('/register', function (req, res) {
    let body = req.body;
    let target = body.target;
    let callback = body.callback;
    let username = body.username;
    let password = body.password;
    let user = { username, password };
    let id = users.length == 0 ? 1 : users[users.length - 1].id + 1;
    user.id = id;
    users.push(user);
    res.status(302);
    res.header('Location', `${target}?callback=${callback}&args=${id}`);
    res.end();
});
app.listen(4000);
```

reg.html

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Documenttitle>
head>

<body>
    <script type="text/javascript">
        window.addEventListener('message', function (event) {
            console.log(event.data);

            if (event.data.receiveId) {
                alert('ç”¨æˆ·ID=' + event.data.receiveId);
            }
        })
    script>
    <iframe name="proxyIframe" id="proxyIframe" frameborder="0">iframe>
    <form action="http://localhost:4000/register" method="POST" target="proxyIframe">
        <input type="hidden" name="callback" value="receiveId">
        <input type="hidden" name="target" value="http://localhost:3000/target.html">
        ç”¨æˆ·å<input type="text" name="username" />
        å¯†ç <input type="text" name="password" />
        <input type="submit" value="æäº¤">
    form>
body>

html>
```

target.html

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Documenttitle>
head>

<body>
    <script>
        window.onload = function () {
            var query = location.search.substr(1).split('&');
            let callback, args;
            for (let i = 0, len = query.length; i < len; i++) {
                let item = query[i].split('=');
                if (item[0] == 'callback') {
                    callback = item[1];
                } else if (item[0] == 'args') {
                    args = item[1];
                }
            }
            try {
                window.parent.postMessage({ [callback]: args }, '*');
            } catch (error) {
                console.log(error);
            }
        }
    script>
body>

html>
```

##### 8.3.7 $.proxy [#](#t97837-proxy)

* æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ–°å‡½æ•°å§‹ç»ˆä¿æŒäº†ç‰¹å®šçš„ä¸Šä¸‹æ–‡è¯­å¢ƒã€‚
* `jQuery.proxy( function, context )` functionä¸ºæ‰§è¡Œçš„å‡½æ•°ï¼Œcontentä¸ºå‡½æ•°çš„ä¸Šä¸‹æ–‡thiså€¼ä¼šè¢«è®¾ç½®æˆè¿™ä¸ªobjectå¯¹è±¡

```js

    jquery proxy

    ç‚¹æˆ‘å˜çº¢

        let btn = document.getElementById('btn');
        btn.addEventListener('click', function () {
            setTimeout($.proxy((function () {
                $(this).css('color', 'red');
            }), this), 1000);
        });

```

```js
function proxy(fn, context) {
    return function () {
       return fn.call(context, arguments);
    }
}
```

##### 8.3.8 Proxy [#](#t98838-proxy)

* Proxy ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸º
* Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚ `&#x62E6;&#x622A;`,å¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚
* Proxy è¿™ä¸ªè¯çš„åŸæ„æ˜¯ä»£ç†ï¼Œç”¨åœ¨è¿™é‡Œè¡¨ç¤ºç”±å®ƒæ¥ `&#x4EE3;&#x7406;`æŸäº›æ“ä½œï¼Œå¯ä»¥è¯‘ä¸º `&#x4EE3;&#x7406;&#x5668;`
* [Proxy](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy)
* [defineProperty](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)

```js
let wang={
    name: 'wanglaoshi',
    age: 29,
    height:165
}
let wangMama=new Proxy(wang,{
    get(target,key) {
        if (key == 'age') {
            return wang.age-1;
        } else if (key == 'height') {
            return wang.height-5;
        }
        return target[key];
    },
    set(target,key,val) {
        if (key == 'boyfriend') {
            let boyfriend=val;
            if (boyfriend.age>40) {
                throw new Error('å¤ªè€');
            } else if (boyfriend.salary<20000) {
                throw new Error('å¤ªç©·');
            } else {
                target[key]=val;
                return true;
            }
        }
    }
});
console.log(wangMama.age);
console.log(wangMama.height);
wangMama.boyfriend={
    age: 41,
    salary:3000
}
```

##### 8.3.9 Vue2å’ŒVue3 [#](#t99839-vue2å’Œvue3)

* Vue2 ä¸­çš„å˜åŒ–ä¾¦æµ‹å®ç°å¯¹ Object åŠ Array åˆ†åˆ«è¿›è¡Œäº†ä¸åŒçš„å¤„ç†,Object ä½¿ç”¨äº† `Object.defineProperty API`, `Array`ä½¿ç”¨äº†æ‹¦æˆªå™¨å¯¹ `Array` åŸå‹ä¸Šçš„èƒ½å¤Ÿæ”¹å˜æ•°æ®çš„æ–¹æ³•è¿›è¡Œæ‹¦æˆªã€‚è™½ç„¶ä¹Ÿå®ç°äº†æ•°æ®çš„å˜åŒ–ä¾¦æµ‹ï¼Œä½†å­˜åœ¨å¾ˆå¤šå±€é™ ï¼Œæ¯”å¦‚å¯¹è±¡æ–°å¢å±æ€§æ— æ³•è¢«ä¾¦æµ‹ï¼Œä»¥åŠé€šè¿‡æ•°ç»„ä¸‹è¾¹ä¿®æ”¹æ•°ç»„å†…å®¹ï¼Œä¹Ÿå› æ­¤åœ¨ Vue2 ä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ° `$set` è¿™ä¸ªæ–¹æ³•å¯¹æ•°æ®ä¿®æ”¹ï¼Œä»¥ä¿è¯ä¾èµ–æ›´æ–°ã€‚
* Vue3 ä¸­ä½¿ç”¨äº† es6 çš„ `Proxy API`å¯¹æ•°æ®ä»£ç†ï¼Œæ²¡æœ‰åƒ `Vue2` ä¸­å¯¹åŸæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œåªæ˜¯åŠ äº†ä»£ç†åŒ…è£…ï¼Œå› æ­¤é¦–å…ˆæ€§èƒ½ä¸Šä¼šæœ‰æ‰€æ”¹å–„ã€‚å…¶æ¬¡è§£å†³äº† `Vue2` ä¸­å˜åŒ–ä¾¦æµ‹çš„å±€é™æ€§ï¼Œå¯ä»¥ä¸ä½¿ç”¨ `$set` æ–°å¢çš„å¯¹è±¡å±æ€§åŠé€šè¿‡ä¸‹æ ‡ä¿®æ”¹æ•°ç»„éƒ½èƒ½è¢«ä¾¦æµ‹åˆ°ã€‚

##### 8.3.10 [#](#t1008310)

* ä»£ç†æ¨¡å¼ VS é€‚é…å™¨æ¨¡å¼ é€‚é…å™¨æä¾›ä¸åŒæ¥å£ï¼Œä»£ç†æ¨¡å¼æä¾›ä¸€æ¨¡ä¸€æ ·çš„æ¥å£
* ä»£ç†æ¨¡å¼ VS è£…é¥°å™¨æ¨¡å¼ è£…é¥°å™¨æ¨¡å¼åŸæ¥çš„åŠŸèƒ½ä¸å˜è¿˜å¯ä»¥ä½¿ç”¨ï¼Œä»£ç†æ¨¡å¼æ”¹å˜åŸæ¥çš„åŠŸèƒ½

## 9.è§‚å¯Ÿè€…æ¨¡å¼ [#](#t1019è§‚å¯Ÿè€…æ¨¡å¼)

* è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°
* åŒåä¸€åŠ å…¥è´­ç‰©è½¦

**  9.1 ç±»å›¾ [#](#t10291-ç±»å›¾)**

* ä¸»é¢˜å¯¹è±¡(Subject) è¯¥è§’è‰²åˆç§°ä¸ºè¢«è§‚å¯Ÿè€…,å¯ä»¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡,å®ƒå°†æœ‰å…³çŠ¶æ€å­˜å…¥å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼Œåœ¨å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰ç™»è®°è¿‡(å…³è”äº†è§‚å¯Ÿå…³ç³»)çš„è§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥
* è§‚å¯Ÿè€…(Observer)è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥æ”¶é€šçŸ¥çš„æ¥å£(update),åœ¨å¾—åˆ°ä¸»é¢˜çš„é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±

![](http://img.zhufengpeixun.cn/teacherobserver.png)
**  9.2 ä»£ç  [#](#t10392-ä»£ç )**

```js
abstract class Student {
    constructor(public teacher: Teacher) { }
    public abstract update();
}
class Xueba extends Student {
    public update() {
        console.log(this.teacher.getState() + ',å­¦éœ¸æŠ¬å¤´ä¸¾æ‰‹');
    }
}
class Xuezha extends Student {
    public update() {
        console.log(this.teacher.getState() + ',å­¦æ¸£ä½å¤´ç¥ˆç¥·');
    }
}

class Teacher {
    private students: Student[] = new Array();
    public state: string = 'è€å¸ˆè®²è¯¾'
    getState() {
        return this.state;
    }
    public askQuestion() {
        this.state = 'è€å¸ˆæé—®';
        this.notifyAllStudents();
    }
    attach(student: Student) {
        this.students.push(student);
    }
    notifyAllStudents() {
        this.students.forEach(student => student.update());
    }
}
let teacher = new Teacher();
teacher.attach(new Xueba(teacher));
teacher.attach(new Xueza(teacher));
teacher.askQuestion();
```

**  9.3 åœºæ™¯ [#](#t10493-åœºæ™¯)**

##### 9.3.1 DOMäº‹ä»¶ç»‘å®š [#](#t105931-domäº‹ä»¶ç»‘å®š)

åŸç”Ÿ

```js

    è§‚å¯Ÿè€…æ¨¡å¼

    click

        let btn = document.getElementById('btn');
        const handler1 = () => { console.log(1); }
        const handler2 = () => { console.log(2); }
        const handler3 = () => { console.log(3); }
        btn.addEventListener('click', handler1);
        btn.addEventListener('click',handler2);
        btn.addEventListener('click', handler3);

```

jquery

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>è§‚å¯Ÿè€…æ¨¡å¼title>
head>

<body>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js">script>
    <button id="btn">clickbutton>
    <script>
        const handler1 = () => { console.log(1); }
        const handler2 = () => { console.log(2); }
        const handler3 = () => { console.log(3); }
        $('#btn').on('clickMe', handler1);
        $('#btn').on('clickMe', handler2);
        $('#btn').on('clickMe', handler3);
        $('#btn').trigger('clickMe');
        console.log('=================================');
        $('#btn').off('clickMe', handler2);
        $('#btn').trigger('clickMe');
    script>
body>

html>
```

##### 9.3.2 Promise [#](#t106932-promise)

```js
class Promise {
    private callbacks: Array<Function> = []
    constructor(fn) {
        let resolve = () => {
            this.callbacks.forEach(callback => callback())
        };
        fn(resolve);
    }
    then(callback) {
        this.callbacks.push(callback);
    }
}
let promise = new Promise(function (resolve) {
    setTimeout(function () {
        resolve(100);
    }, 1000);
});
promise.then(() => console.log(1));
promise.then(() => console.log(2));
```

##### 9.3.3 callbacks [#](#t107933-callbacks)

* `JQuery.Callbacks`æ˜¯jQuery1.7+ä¹‹åå¼•å…¥çš„ï¼Œç”¨æ¥è¿›è¡Œå‡½æ•°é˜Ÿåˆ—çš„addã€removeã€fireã€lockç­‰æ“ä½œ
* Callbackså¯¹è±¡å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°é˜Ÿåˆ—ï¼Œè·å¾—Callbackså¯¹è±¡ä¹‹å ï¼Œå°±å¯ä»¥å‘è¿™ä¸ªé›†åˆä¸­å¢åŠ æˆ–è€…åˆ é™¤å‡½æ•°ã€‚addå’ŒremoveåŠŸèƒ½ç›¸åï¼Œå‡½æ•°å‚æ•°æ˜¯ç›¸åŒçš„ï¼Œempty()åˆ é™¤å›è°ƒåˆ—è¡¨ä¸­çš„æ‰€æœ‰å‡½æ•°

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Documenttitle>
head>

<body>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js">script>
    <script>
        let callbacks = $.Callbacks();

        let a1 = () => alert(1);
        let a2 = () => alert(2);
        let a3 = () => alert(13);
        callbacks.add(a1);
        callbacks.add(a2);
        callbacks.add(a3);
        callbacks.remove(a3);
        callbacks.fire();
    script>
body>
html>
```

Callbacks

```js
function Callbacks() {
    let observers = [];
    function add(observer) {
        observers.push(observer);
    }
    function remove(observer) {
        let index = observers.indexOf(observer);
        if (index != -1)
            observers.splice(index, 1);
    }
    function fire() {
        observers.forEach(observer => observer());
    }
    return {
        add,
        remove,
        fire
    }
}
```

##### 9.3.4 EventEmitter [#](#t108934-eventemitter)

è‡ªå®šä¹‰äº‹ä»¶

```js
const EventEmitter = require('events');
let subject = new EventEmitter();
subject.on('click', function (name) {
    console.log(1, name);
});
subject.on('click', function (name) {
    console.log(2, name);
});
subject.emit('click', 'zhufeng');
```

events.js

```js
class EventEmitter{
    constructor() {
        this._events={};
    }
    on(type,listener) {
        let listeners=this._events[type];
        if (listeners) {
            listeners.push(listener);
        } else {
            this._events[type]=[listener];
        }
    }
    emit(type) {
        let listeners=this._events[type];
        let args=Array.from(arguments).slice(1);
        listeners.forEach(listener => listener(...args));
    }
}
module.exports = EventEmitter;
```

##### 9.3.5 æµ [#](#t109935-æµ)

```js
let fs = require('fs');
let rs = fs.createReadStream('./1.txt', { highWaterMark: 3 });
rs.on('data', function (data) {
    console.log(data.toString());
});
rs.on('end', function () {
    console.log('end');
});
```

##### 9.3.6 httpæœåŠ¡å™¨ [#](#t110936-httpæœåŠ¡å™¨)

```js
let http = require('http');
let server = http.createServer();
server.on('request', (req, res) => {
    res.end('zhufeng');
});
server.listen(3000);
```

##### 9.3.7 ç”Ÿå‘½å‘¨æœŸå‡½æ•° [#](#t111937-ç”Ÿå‘½å‘¨æœŸå‡½æ•°)

![](http://img.zhufengpeixun.cn/reactlifecycles.jpg)

![](http://img.zhufengpeixun.cn/vuelifecycles.jpg)

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Documenttitle>
head>

<body>
    <div id="root">div>
    <script>
        let container = document.getElementById('root');
        class Component {
            state = { number: 0 }
            componentWillMount() {
                console.log('componentWillMount');
            }

            componentDidMount() {
                console.log('componentDidMount');
            }
            shouldComponentUpdate() {
                console.log('shouldComponentUpdate');
                return true;
            }
            componentWillUpdate() {
                console.log('componentWillUpdate');
            }

            componentDidUpdate() {
                console.log('componentDidUpdate');
            }
            setState(newState) {
                this.state = { ...this.state, ...newState }
                if (!this.shouldComponentUpdate || (this.shouldComponentUpdate && this.shouldComponentUpdate())) {
                    if (this.componentWillUpdate)
                        this.componentWillUpdate();
                    let content = this.render();
                    container.innerHTML = content;
                    if (this.componentDidUpdate)
                        this.componentDidUpdate();
                }
            }
            render() {
                console.log('render');
                return this.state.number;
            }
        }
        render(Component, document.getElementById('root'));
        function render(Component, container) {

            let component = new Component();
            if (component.componentWillMount)
                component.componentWillMount();
            let content = component.render();
            container.innerHTML = content;
            if (component.componentDidMount)
                component.componentDidMount();

            setTimeout(() => {
                component.setState({ number: 1 });
            }, 3000);
        }

    script>
body>

html>
```

##### 9.3.8 EventBus [#](#t112938-eventbus)

* å¦‚æœä½ è§‰å¾—ä½¿ç”¨ `$on`ã€ `$emit`ä¸æ–¹ä¾¿,è€Œä½ åˆä¸æ„¿æ„å¼•å…¥ `vuex`,å¯ä»¥ä½¿ç”¨ `EventBus`
* åœ¨è¦ç›¸äº’é€šä¿¡çš„å…„å¼Ÿç»„ä»¶ä¹‹ä¸­ï¼Œéƒ½å¼•å…¥ä¸€ä¸ªæ–°çš„vueå®ä¾‹ï¼Œç„¶åé€šè¿‡åˆ†åˆ«è°ƒç”¨è¿™ä¸ªå®ä¾‹çš„äº‹ä»¶è§¦å‘å’Œç›‘å¬æ¥å®ç°é€šä¿¡å’Œå‚æ•°ä¼ é€’

EventBus.js

```js
import Vue from 'vue';
export default new Vue();
```

ç»„ä»¶A

```js
import EventBus from './EventBus';
EventBus.$on("customEvent", name => {
    console.log(name);
})
```

ç»„ä»¶B

```js
import EventBus from './EventBus';
EventBus.$emit("customEvent", 'zhufeng')
```

```html
<body>
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js">script>
    <script>
        let EventBus = new Vue();
        EventBus.$on("customEvent", name => {
            console.log(name);
        })
        EventBus.$emit("customEvent", 'zhufeng')
    script>
body>
```

##### 9.3.9 Vueå“åº”å¼ [#](#t113939-vueå“åº”å¼)

* åœ¨ Vue ä¸­ï¼Œæ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æœ‰ç›¸åº”çš„ `watcher` å®ä¾‹å¯¹è±¡ï¼Œå®ƒä¼šåœ¨ç»„ä»¶æ¸²æŸ“çš„è¿‡ç¨‹ä¸­æŠŠå±æ€§è®°å½•ä¸ºä¾èµ–ï¼Œä¹‹åå½“ä¾èµ–é¡¹çš„ `setter` è¢«è°ƒç”¨æ—¶ï¼Œä¼šé€šçŸ¥ `watcher` é‡æ–°è®¡ç®—ï¼Œä»è€Œè‡´ä½¿å®ƒå…³è”çš„ç»„ä»¶å¾—ä»¥æ›´æ–°

![](http://img.zhufengpeixun.cn/vuereactive.jpg)

```html

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>vuetitle>
head>

<body>
    <div id="name">div>
    <div id="age">div>
    <script>
        let name = document.getElementById('name');
        let age = document.getElementById('age');
        class Dep {
            subs = []
            addSub(sub) {
                this.subs.push(sub);
            }
            notify() {
                this.subs.forEach((sub) => sub())
            }
        }
        function observe(target) {
            Object.keys(target).forEach((key) => {
                let val = target[key];
                const dep = new Dep();
                if (key == 'name') {
                    name.innerHTML = val;
                    dep.addSub(() => { name.innerHTML = val });
                } else if (key == 'age') {
                    age.innerHTML = val;
                    dep.addSub(() => { age.innerHTML = val });
                }
                Object.defineProperty(target, key, {
                    get: function () {
                        return val;
                    },
                    set: function (value) {
                        val = value;
                        dep.notify();
                    }
                });
            })
        }

        let obj = { name: 'åç§°', age: 'å¹´é¾„' };
        observe(obj);
        setTimeout(() => {
            obj.name = 'æ–°åç§°';
        }, 3000);
        setTimeout(() => {
            obj.age = 'æ–°å¹´é¾„';
        }, 6000);
    script>
body>
html>
```

##### 9.3.9 redux [#](#t114939-redux)

* [createStore](https://github.com/reduxjs/redux/blob/master/src/createStore.js)

```js
export default function createStore(reducer,preloadedState,enhancer) {
    if (enhancer) {
        return enhancer(createStore)(reducer,preloadedState);
    }
    let state=preloadedState;
    let listeners=[];
    function getState() {
        return state;
    }
    function subscribe(listener) {
        listeners.push(listener);
        return function () {
            const index=listeners.indexOf(listener);
            listeners.splice(index,1);
        }
    }
    function dispatch(action) {
        state=reducer(state,action);
        listeners.forEach(listener=>listener())
    }
    dispatch({type:'@@redux/INIT'});
    return {
        dispatch,
        subscribe,
        getState
    }
}
```

**  9.4 å‘å¸ƒè®¢é˜…æ¨¡å¼ [#](#t11594-å‘å¸ƒè®¢é˜…æ¨¡å¼)**

##### 9.4.1 åŒºåˆ« [#](#t116941-åŒºåˆ«)

* è®¢é˜…è€…æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ
* å½“è¯¥äº‹ä»¶è§¦å‘æ—¶å€™ï¼Œå‘å¸ƒè€…å‘å¸ƒè¯¥äº‹ä»¶åˆ°è°ƒåº¦ä¸­å¿ƒ,ç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒåº¦è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚
* è™½ç„¶ä¸¤ç§æ¨¡å¼éƒ½å­˜åœ¨è®¢é˜…è€…å’Œå‘å¸ƒè€…ï¼ˆè§‚å¯Ÿè€…å¯è®¤ä¸ºæ˜¯è®¢é˜…è€…ã€è¢«è§‚å¯Ÿè€…å¯è®¤ä¸ºæ˜¯å‘å¸ƒè€…ï¼‰
* ä½†æ˜¯è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ç”±è¢«è§‚å¯Ÿè€…è°ƒåº¦çš„ï¼Œè€Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼æ˜¯ç»Ÿä¸€ç”±è°ƒåº¦ä¸­å¿ƒè°ƒçš„
* æ‰€ä»¥è§‚å¯Ÿè€…æ¨¡å¼çš„è®¢é˜…è€…ä¸å‘å¸ƒè€…ä¹‹é—´æ˜¯å­˜åœ¨ä¾èµ–çš„ï¼Œè€Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼åˆ™ä¸ä¼šã€‚

![](http://img.zhufengpeixun.cn/subscribepattern.jpg)

##### 9.4.2 ç±»å›¾ [#](#t117942-ç±»å›¾)

![](http://img.zhufengpeixun.cn/publishsubscribe.png)

##### 9.4.3 ä»£ç  [#](#t118943-ä»£ç )

```js
class Agency {
    _topics = {}
    subscribe(topic, listener) {
        let listeners = this._topics[topic];
        if (listeners) {
            listeners.push(listener);
        } else {
            this._topics[topic] = [listener];
        }
    }
    publish(topic, ...args) {
        let listeners = this._topics[topic] || [];
        listeners.forEach(listener => listener(...args));
    }
}
class Landlord {
    constructor(public agent: Agency) { }
    lend(topic, area, money) {
        this.agent.publish(topic, area, money);
    }
}

class Tenant {
    constructor(public agent: Agency, public name: string) { }
    order(topic) {
        this.agent.subscribe(topic, (area, money) => {
            console.log(this.name, `${area}å¹³ç±³, ${money}å…ƒ`);
        });
    }
}
let agent = new Agency();
let rich = new Tenant(agent, 'å¤§æ¬¾');
let poor = new Tenant(agent, 'åŒ—æ¼‚');
let landlord = new Landlord(agent);
rich.order('è±ªå®…');
poor.order('å•é—´');
landlord.lend('è±ªå®…', 10000, 1000000);
landlord.lend('å•é—´', 10, 1000);
```

##### 9.4.4 Rediså‘å¸ƒè®¢é˜… [#](#t119944-rediså‘å¸ƒè®¢é˜…)

* Redis å‘å¸ƒè®¢é˜…æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…æ¥æ”¶æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚

![](http://img.zhufengpeixun.cn/redissubscribe.jpg)

![](http://img.zhufengpeixun.cn/redispublishsubscribe.png)

```js
SUBSCRIBE channel_a
PUBLISH channel_a zhufeng
```

```js
let redis = require('redis');
let client1 = redis.createClient(6379, '127.0.0.1');
let client2 = redis.createClient(6379, '127.0.0.1');

client1.subscribe('channel_a');
client1.subscribe('channel_b');
client1.on('message', (channel, message) => {
    console.log('client1', channel, message);
    client1.unsubscribe('channel_a');
});
client2.publish('channel_a', 'a_hello');
client2.publish('channel_b', 'b_hello');

setTimeout(() => {
    client2.publish('channel_a', 'a_world');
    client2.publish('channel_b', 'b_world');
}, 3000);
```

## 10. å¤–è§‚æ¨¡å¼ [#](#t12010-å¤–è§‚æ¨¡å¼)

* å¤–è§‚æ¨¡å¼(Facade Pattern)åˆå«é—¨é¢æ¨¡å¼ï¼Œå®šä¹‰ä¸€ä¸ªå°†å­ç³»ç»Ÿçš„ä¸€ç»„æ¥å£é›†æˆåœ¨ä¸€èµ·çš„é«˜å±‚æ¥å£ï¼Œä»¥æä¾›ä¸€ä¸ªä¸€è‡´çš„å¤–è§‚
* å¤–è§‚æ¨¡å¼è®©å¤–ç•Œå‡å°‘ä¸å­ç³»ç»Ÿå†…å¤šä¸ªæ¨¡å—çš„ç›´æ¥äº¤äº’ï¼Œä»è€Œå‡å°‘è€¦åˆï¼Œè®©å¤–ç•Œå¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨å­ç³»ç»Ÿ
* è¯¥è®¾è®¡æ¨¡å¼ç”±ä»¥ä¸‹è§’è‰²ç»„æˆ
  - é—¨é¢è§’è‰²ï¼šå¤–è§‚æ¨¡å¼çš„æ ¸å¿ƒã€‚å®ƒè¢«å®¢æˆ·è§’è‰²è°ƒç”¨,å®ƒç†Ÿæ‚‰å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚å†…éƒ¨æ ¹æ®å®¢æˆ·è§’è‰²çš„éœ€æ±‚é¢„å®šäº†å‡ ç§åŠŸèƒ½çš„ç»„åˆ
  - å­ç³»ç»Ÿè§’è‰²:å®ç°äº†å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚å®ƒå¯¹å®¢æˆ·è§’è‰²å’Œ `Facade`æ˜¯æœªçŸ¥çš„
  - å®¢æˆ·è§’è‰²:é€šè¿‡è°ƒç”¨Facedeæ¥å®Œæˆè¦å®ç°çš„åŠŸèƒ½
* é¥æ§å™¨ã€è‡ªåŠ¨é©¾é©¶æ±½è½¦ã€æˆ¿å±‹ä¸­ä»‹

![](http://img.zhufengpeixun.cn/xiaomicontrol.jpg)

![](http://img.zhufengpeixun.cn/facadepattern.jpeg)
**  10.1 è®¡ç®—å™¨ [#](#t121101-è®¡ç®—å™¨)**

![](http://img.zhufengpeixun.cn/facadepattern2.jpeg)

```js
class Sum {
    sum(a, b) {
        return a + b;
    }
}
class Minus {
    minus(a, b) {
        return a - b;
    }
}
class Multiply {
    multiply(a, b) {
        return a * b;
    }
}
class Calculator {
    sumObj
    minusObj
    multiplyObj
    constructor() {
        this.sumObj = new Sum();
        this.minusObj = new Minus();
        this.multiplyObj = new Multiply();
    }
    sum(...args) {
        return this.sumObj.sum(...args);
    }
    minus(...args) {
        return this.minusObj.minus(...args);
    }
    multiply(...args) {
        return this.multiplyObj.multiply(...args);
    }
}
let calculator = new Calculator();
console.log(calculator.sum(1, 2));
console.log(calculator.minus(1, 2));
console.log(calculator.multiply(1, 2));
```

**  10.2 è®¡ç®—æœº [#](#t122102-è®¡ç®—æœº)**

![](http://img.zhufengpeixun.cn/computer2.jpg)

```js

class CPU {
    startup() { console.log('æ‰“å¼€CPU'); }
    shutdown() { console.log('å…³é—­CPU'); }
}
class Memory {
    startup() { console.log('æ‰“å¼€å†…å­˜'); }
    shutdown() { console.log('å…³é—­å†…å­˜'); }
}
class Disk {
    startup() { console.log('æ‰“å¼€ç¡¬ç›˜'); }
    shutdown() { console.log('å…³é—­ç¡¬ç›˜'); }
}
class Computer {
    cpu;
    memory;
    disk;
    constructor() {
        this.cpu = new CPU();
        this.memory = new Memory();
        this.disk = new Disk();
    }
    startup() {
        this.cpu.startup();
        this.memory.startup();
        this.disk.startup();
    }
    shutdown() {
        this.cpu.shutdown();
        this.memory.shutdown();
        this.disk.shutdown();
    }
}
let computer = new Computer();
computer.startup();
computer.shutdown();
```

**  10.3 å‹ç¼© [#](#t123103-å‹ç¼©)**

```js
export { }
var zlib = require('zlib');
var fs = require('fs');
let path = require('path');
function open(input) {
    let ext = path.extname(input);
    switch (ext) {
        case '.gz':
            return unZip(input);
        case '.rar':
            return unRar(input);
        case '.7z':
            return un7z(input);
        default:
            break;
    }
}
function unZip(src) {
    var gunzip = zlib.createGunzip();
    var inputStream = fs.createReadStream(src);
    var outputStream = fs.createWriteStream(src.slice(0, -3));
    console.log('outputStream');

    inputStream.pipe(gunzip).pipe(outputStream);
}
function unRar(src) {
    console.log('Rarè§£å‹åçš„', src);
}
function un7z(src) {
    console.log('7zè§£å‹åçš„', src);
}
open('./source.txt.gz');

function zip(src) {
    var gzip = zlib.createGzip();
    var inputStream = fs.createReadStream(src);
    var outputStream = fs.createWriteStream(src+'.gz');
    inputStream.pipe(gzip).pipe(outputStream);
}
zip('source.txt');
```

**  10.4 redux [#](#t124104-redux)**

* [redux index.js](https://github.com/reduxjs/redux/blob/v4.0.0/src/index.js)

**  10.5 å‡½æ•°é‡è½½ [#](#t125105-å‡½æ•°é‡è½½)**

* ä¸ºå¤æ‚çš„æ¨¡å—æˆ–å­ç³»ç»Ÿæä¾›å¤–ç•Œè®¿é—®çš„æ¨¡å—
* å­ç³»ç»Ÿç›¸äº’ç‹¬ç«‹

##### 10.5.1 å‚æ•°é‡è½½ [#](#t1261051-å‚æ•°é‡è½½)

sum.ts

```js
function sum(a: number, b: string);
function sum(a: string, b: number);
function sum(a: any, b: any) {
    return a + b;
}
```

##### 10.5.2 react createElement [#](#t1271052-react-createelement)

-[react create-element](https://github.com/facebook/react/blob/master/packages/react/src/ReactElement.js#L347-L361)

```js
export function createElement (
  context: Component,
  tag: any,
  data: any,
  children: any,
  normalizationType: any,
  alwaysNormalize: boolean
): VNode | Array<VNode> {
  if (Array.isArray(data) || isPrimitive(data)) {
    normalizationType = children
    children = data
    data = undefined
  }
  if (isTrue(alwaysNormalize)) {
    normalizationType = ALWAYS_NORMALIZE
  }
  return _createElement(context, tag, data, children, normalizationType)
}
```

##### 10.5.3 vue createElement [#](#t1281053-vue-createelement)

-[vue create-element](https://github.com/vuejs/vue/blob/v2.6.10/src/core/vdom/create-element.js#L28-L45)

```js
  const childrenLength = arguments.length - 2;
  if (childrenLength === 1) {
    props.children = children;
  } else if (childrenLength > 1) {
    const childArray = Array(childrenLength);
    for (let i = 0; i < childrenLength; i++) {
      childArray[i] = arguments[i + 2];
    }
    if (__DEV__) {
      if (Object.freeze) {
        Object.freeze(childArray);
      }
    }
    props.children = childArray;
  }
```

##### 10.5.4 buffer [#](#t1291054-buffer)

[buffer.js](https://github.com/nodejs/node/blob/master/lib/buffer.js#L1082)

```js
Buffer.prototype.slice = function slice(start, end) {
  const srcLength = this.length;
  end = end !== undefined ? srcLength: srcLength;
  const newLength = end > start ? end - start : 0;
  return new FastBuffer(this.buffer, this.byteOffset + start, newLength);
};
```

##### 10.5.5 createStore [#](#t1301055-createstore)

* [createStore](https://github.com/reduxjs/redux/blob/e95eaf2dc2024fe99dc0f7334a8bd049b4949ed0/src/createStore.js#L31-L35)

```js
export default function createStore(reducer, preloadedState, enhancer) {
  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {
    enhancer = preloadedState
    preloadedState = undefined
  }
}
```

##### 10.5.6 axios [#](#t1311056-axios)

* [defaults](https://github.com/axios/axios/blob/v0.19.0/lib/defaults.js#L16-L27)

```js
function getDefaultAdapter() {
  var adapter;
  if (typeof process !== 'undefined' && Object.prototype.toString.call(process) === '[object process]') {
    adapter = require('./adapters/http');
  } else if (typeof XMLHttpRequest !== 'undefined') {
    adapter = require('./adapters/xhr');
  }
  return adapter;
}
```

##### 10.5.7 polyfill [#](#t1321057-polyfill)

* polyfillå¯ä»¥è®©æˆ‘ä»¬å¤„ç†æµè§ˆå™¨å…¼å®¹å’Œå±è”½äº†æµè§ˆå™¨å·®å¼‚
* [removeEvent](https://github.com/jquery/jquery/blob/1.5/src/event.js#L584-L596)

```js
jQuery.removeEvent = document.removeEventListener ?
    function( elem, type, handle ) {
        if ( elem.removeEventListener ) {
            elem.removeEventListener( type, handle, false );
        }
    } :
    function( elem, type, handle ) {
        if ( elem.detachEvent ) {
            elem.detachEvent( "on" + type, handle );
        }
    };
```

## 11. è¿­ä»£å™¨æ¨¡å¼ [#](#t13311-è¿­ä»£å™¨æ¨¡å¼)

* è¿­ä»£å™¨æ¨¡å¼(Iterator Pattern)ç”¨äºé¡ºåºåœ°è®¿é—®èšåˆå¯¹è±¡å†…éƒ¨çš„å…ƒç´ ï¼Œåˆæ— éœ€çŸ¥é“å¯¹è±¡å†…éƒ¨ç»“æ„ã€‚ä½¿ç”¨äº†è¿­ä»£å™¨ä¹‹åï¼Œä½¿ç”¨è€…ä¸éœ€è¦å…³å¿ƒå¯¹è±¡çš„å†…éƒ¨æ„é€ ï¼Œå°±å¯ä»¥æŒ‰åºè®¿é—®å…¶ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚

### 11.1 ç±»å›¾ [#](#t134111-ç±»å›¾)

![](http://img.zhufengpeixun.cn/iteratorpattern.jpeg)

### 11.2 ä»£ç  [#](#t135112-ä»£ç )

```js
function createIterator(arr) {
    let index=0;
    return {
        next() {
            return indexvalue: arr[index++],done: false}:
                {done:true}
        }
    }
}
let it=createIterator([1,2]);
console.log(it.next());
console.log(it.next());
console.log(it.next());
```

### 11.3 åœºæ™¯ [#](#t136113-åœºæ™¯)

**  11.3.1 forEach [#](#t1371131-foreach)**

* å¯ä»¥ä½¿ç”¨ for å¾ªç¯è‡ªå·±å®ç°ä¸€ä¸ª `forEach`

```js
Array.prototype.forEach = function (cb) {
  for (var i = 0; i < this.length; i++) {
      cb.call(this, this[i], i, arr);
  }
}
let arr = [1, 2, 3];
arr.forEach((item) => {
  console.log(item);
});
```

**  11.3.2 each [#](#t1381132-each)**

* [jquery](https://github.com/jquery/jquery/blob/3.4.1/src/core.js#L246-L265)
* [underscore](https://github.com/jashkenas/underscore/blob/1.9.1/underscore.js#L181-L195)

```html
<body>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js">script>
    <script>

    $.each(['1', '2', '3'], function (index, item) {
        console.log(index, item);
    })
    $.each({ name: 'zhufeng', age: 10 }, function (index, item) {
        console.log(index, item);
    })
    function each(obj, callback) {
        if (Array.isArray(obj)) {
            let length = obj.length;
            for (let i = 0; i < length; i++) {
                if (callback.call(obj[i], i, obj[i]) === false) {
                    break;
                }
            }
        } else {
            for (let i in obj) {
                if (callback.call(obj[i], i, obj[i]) === false) {
                    break;
                }
            }
        }

        return obj;
    }

    script>

body>
```

**  11.3.3 Iterator [#](#t1391133-iterator)**

* åœ¨ES6ä¸­æœ‰åºé›†åˆæ•°æ®ç±»å‹æœ‰Arrayã€Mapã€Setã€Stringã€TypedArrayã€argumentsã€NodeList
* æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªç»Ÿä¸€çš„éå†æ¥å£æ¥éå†æ‰€æœ‰çš„æ•°æ®ç±»å‹
* ä»–ä»¬éƒ½æœ‰ [Symbol.Iterator]å±æ€§ï¼Œå±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°ä¼šè¿”å›è¿­ä»£å™¨
* è¿­ä»£å™¨å°±æœ‰ `next`æ–¹æ³•é¡ºåºè¿”å›å­å…ƒç´ 

```js
Array[Symbol.iterator] = function () {
    let index = 0;
    return {
        next: () => {
            return index < this.length ?
                { value: this[index++], done: false } :
                { done: true }
        }
    }
}
let arr = [1, 2];
let it = arr[Symbol.iterator]();
console.log(it.next());
console.log(it.next());
console.log(it.next());
```

**  11.3.4 yield* [#](#t1401134-yield)**

* yield*åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå¯éå†çš„ç»“æ„ï¼Œå®ƒä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£

```js
let generator = function* () {
    yield 1;
    yield* [2, 3];
    yield 4;
};

var iterator = generator();

console.log(iterator.next());
console.log(iterator.next());
console.log(iterator.next());
console.log(iterator.next());
console.log(iterator.next());
```

**  11.3.5 äºŒå‰æ ‘éå† [#](#t1411135-äºŒå‰æ ‘éå†)**

* äºŒå‰æ ‘æ˜¯æ¯ä¸ªç»“ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­æ ‘çš„æ ‘ç»“æ„ã€‚é€šå¸¸å­æ ‘è¢«ç§°ä½œå·¦å­æ ‘å’Œå³å­æ ‘
* æ ¹æ®æ ¹æ®æ ¹èŠ‚ç‚¹çš„é¡ºåºå¯ä»¥æŠŠéå†åˆ†ä¸ºä¸‰ç§å‰åºã€ä¸­åºã€ååº
  - å…ˆåºéå†ï¼šæ ¹èŠ‚ç‚¹->å·¦å­æ ‘->å³å­æ ‘
  - ä¸­åºéå†ï¼šå·¦å­æ ‘->æ ¹èŠ‚ç‚¹->å³å­æ ‘
  - ååºéå†ï¼šå·¦å­æ ‘->å³å­æ ‘->æ ¹èŠ‚ç‚¹

![](http://img.zhufengpeixun.cn/varorder.png)

```js
class Tree {
    constructor(public left, public value, public right) {
    }
}

function* leftOrder(tree) {
    if (tree) {
        yield tree.value;
        yield* leftOrder(tree.left);
        yield* leftOrder(tree.right);
    }
}

function* inOrder(tree) {
    if (tree) {
        yield* inOrder(tree.left);
        yield tree.value;
        yield* inOrder(tree.right);
    }
}

function* rightOrder(tree) {
    if (tree) {
        yield* rightOrder(tree.left);
        yield* rightOrder(tree.right);
        yield tree.value;
    }
}
function make(array) {
    if (array.length === 1) return new Tree(null, array[0], null);
    return new Tree(make(array[0]), array[1], make(array[2]));
}
let tree = make([[['D'], 'B', ['E']], 'A', [['F'], 'C', ['G']]]);
var result: any[] = [];
for (let node of rightOrder(tree)) {
    result.push(node);
}
console.log(result);
```

> "downlevelIteration": true, / _Provide full support for iterables in 'for-of', spread, and destructuring when targeting 'ES5' or 'ES3'._/
