---
link: null
title: 珠峰架构师成长计划
description: 要考虑数据驱动视图，多次点击显示多个弹层,给每个层增加 id号,延迟时间和内容
keywords: null
author: null
date: null
publisher: 珠峰架构师成长计划
stats: paragraph=24 sentences=51, words=477
---
## Message组件的调用方式 [#](#t0message组件的调用方式)

```
<template>
    <button @click="showMessage">&#x70B9;&#x6211;&#x554A;</button>
</template>
<script>
export default {
    methods:{
        showMessage(){
            Message.info({ // 直接调用
                content:'hello 我帅不帅',
                duration:3000
            });
            this.$message.info({ // 通过实例调用
                content:'hello 你很帅',
                duration:3000
            })
        }
    }
}
</script>
```

## 编写Message组件 [#](#t1编写message组件)

要考虑数据驱动视图，多次点击显示多个弹层,给每个层增加 id号,延迟时间和内容

```
<template>
    <div class="messages">
        <!-- 显示在数组中的层 -->
        <div v-for="message in messages" :key="message.id">
            {{message.content}}
        </div>
    </div>
</template>
<script>
export default {
    data(){
        return {messages:[]}
    },
    mounted(){
        // 给所有弹层增加唯一标示 方便弹层的卸载
        this.id = 0;
    },
    methods:{
        add(option){
            let id = this.id++; // id号
            let layer = {...option,id}
            this.messages.push(layer); // 将层存储起来
            layer.timer = setTimeout(()=>{
                this.remove(layer);
            },option.duration)
        },
        remove(layer){
            clearTimeout(layer.timer); // 清除定时器
            // 移除层
            this.messages = this.messages.filter(message=>layer.id !== message.id);
        }
    }
}
</script>
```

## 通过js文件控制显示Message弹层 [#](#t2通过js文件控制显示message弹层)

* 步骤一:暴露调用方法

```
// &#x66B4;&#x9732; &#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5F39;&#x5C42;&#x65B9;&#x6CD5;
const Message = {
  info(options){
      // &#x8C03;&#x7528;&#x589E;&#x52A0;&#x5F39;&#x5C42;&#x65B9;&#x6CD5;
      getInstance(options).add(options);
  },
  warn(){},
  danger(){},
  success(){}
}
export {
  Message
}
```

* 步骤二:生产实例

```
import Vue from 'vue';
import MessageComponent from './Message.vue';
let getInstance = () =>{
    let vm = new Vue({
        render:h=>h(MessageComponent)
    }).$mount();
    let messageComponent = vm.$children[0];
    // &#x83B7;&#x53D6;&#x771F;&#x5B9E;dom&#x5143;&#x7D20;&#xFF0C;&#x5C06;&#x5176;&#x6302;&#x5728;&#x9875;&#x9762;&#x4E0A;
    document.body.appendChild(vm.$el);
    return {
        add(options){ // &#x8C03;&#x7528;&#x7EC4;&#x4EF6;&#x7684;add&#x65B9;&#x6CD5;
            messageComponent.add(options);
        }
    }
}
const Message = {
    info(options){
        // &#x8C03;&#x7528;&#x589E;&#x52A0;&#x5F39;&#x5C42;&#x65B9;&#x6CD5;
        getInstance().add(options);
    },
    warn(){},
    danger(){},
    success(){}
}
// &#x66B4;&#x9732; &#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5F39;&#x5C42;&#x65B9;&#x6CD5;
export {
    Message
}
```

* 步骤三: 实现单例

```
let instance;
let inst = () => {
    instance = instance || getInstance();
    return instance;
}
const Message = {
    info(options){
        // &#x8C03;&#x7528;&#x589E;&#x52A0;&#x5F39;&#x5C42;&#x65B9;&#x6CD5;
        inst().add(options);
    },
    warn(){},
    danger(){},
    success(){}
}
// &#x66B4;&#x9732; &#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5F39;&#x5C42;&#x65B9;&#x6CD5;
export {
    Message
}
```

## 封装插件 [#](#t3封装插件)

install方法和use方法的应用

```
let _Vue;
export default {
    install(Vue,options){
        if(!_Vue){
            _Vue = Vue;
            let $message = {}
            Object.keys(Message).forEach(type => {
                $message[type] = Message[type]
            });
            Vue.prototype.$message = $message
        }
    }
}
// &#x7EC4;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x63D2;&#x4EF6;
import {Message} from './components/Message';
this.$message.info({
        content:'hello &#x4F60;&#x5F88;&#x5E05;',
        duration:3000
})
```

## Minx方法可以注入数据 [#](#t4minx方法可以注入数据)

给每个组件增加公用属性

```
Vue.mixin({
    beforeCreate() {
        if(this.$options.info){
            // &#x628A;&#x6570;&#x636E;&#x6302;&#x5728;&#x81EA;&#x5DF1;&#x7684;_info&#x4E0A;
            this._info = this.$options.info;
        }else{
            this._info = this.$parent && this.$parent._info;
        }
    },
})
```
