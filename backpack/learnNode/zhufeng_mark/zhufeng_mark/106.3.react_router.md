---
link: null
title: 珠峰架构师成长计划
description: public\index.html
keywords: null
author: null
date: null
publisher: 珠峰架构师成长计划
stats: paragraph=156 sentences=849, words=5003
---
## 内容大纲 [#](#t0内容大纲)

* React路由原理
* 基本路由使用和实现
* 实现history
* 实现正则匹配
* 实现Switch
* 实现Redirect
* 实现Link
* 实现嵌套路由
* 实现受保护路由
* 实现NavLink
* 实现withRouter
* 实现Prompt
* 实现hooks

## 1. React路由原理 [#](#t11-react路由原理)

* 不同的路径渲染不同的组件
* 有两种实现方式
  - HashRouter:利用hash实现路由切换
  - BrowserRouter:实现h5 Api实现路由的切换

### 1.1 HashRouter [#](#t211-hashrouter)

* 利用hash实现路由切换

public\index.html

```js

    Document

        #root{
            border:1px solid red;
        }

        /a
        /b

        window.addEventListener('hashchange',()=>{
            console.log(window.location.hash);
            let pathname = window.location.hash.slice(1);//把最前面的那个#删除
            root.innerHTML = pathname;
        });

```

### 1.2 BrowserRouter [#](#t312-browserrouter)

* 利用h5 Api实现路由的切换

#### 1.2.1 history [#](#t4121-history)

* HTML5规范给我们提供了一个[history](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/history)接口
* HTML5 History API包括2个方法： `history.pushState()`和 `history.replaceState()`，和1个事件 `window.onpopstate`

##### 1.2.1.1 pushState [#](#t51211-pushstate)

* history.pushState(stateObject, title, url)，包括三个参数
  - 第一个参数用于存储该url对应的状态对象，该对象可在onpopstate事件中获取，也可在history对象中获取
  - 第二个参数是标题，目前浏览器并未实现
  - 第三个参数则是设定的url
* pushState函数向浏览器的历史堆栈压入一个url为设定值的记录，并改变历史堆栈的当前指针至栈顶

##### 1.2.1.2 replaceState [#](#t61212-replacestate)

* 该接口与pushState参数相同，含义也相同
* 唯一的区别在于 `replaceState`是替换浏览器历史堆栈的当前历史记录为设定的url
* 需要注意的是 `replaceState`不会改动浏览器历史堆栈的当前指针

##### 1.2.1.3 onpopstate [#](#t71213-onpopstate)

* 该事件是window的属性
* 该事件会在调用浏览器的前进、后退以及执行 `history.forward`、 `history.back`、和 `history.go`触发，因为这些操作有一个共性，即修改了历史堆栈的当前指针
* 在不改变document的前提下，一旦当前指针改变则会触发 `onpopstate`事件

##### 1.2.1.4 案例 [#](#t81214-案例)

* 浏览器针对每个页面维护一个 `History`栈,执行 `pushState`函数可压入设定的 `url`至栈顶,同时修改当前指针
* 当执行 `back`和 `forward`操作时，history栈大小并不会改变（history.length不变），仅仅移动当前指针的位置
* 若当前指针在history栈的中间位置(非栈顶)，此时执行pushState会在指针当前的位置添加此条目,并成为新的栈顶

```html

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documenttitle>
    <style>
        #root{
            border:1px solid red;
            height:20px;
        }
    style>
head>
<body>
    <div id="root">div>
    <script>
        var historyObj = window.history;

        window.onpushstate = (event) => {
            console.log(event.type,event.detail.state);
            root.innerHTML = window.location.pathname;
        }
        window.addEventListener('popstate', (event) => {
            console.log(event.type,event.state);
            root.innerHTML = window.location.pathname;
        });

        (function (historyObj) {
            let oldPushState = history.pushState;
            historyObj.pushState = function (state, title, pathname) {
                let result = oldPushState.apply(history, arguments);
                if (typeof window.onpushstate === 'function') {
                    window.onpushstate(new CustomEvent('pushstate',{detail:{pathname,state}}));
                }
                return result;
            }
        })(historyObj);
        let oldHistoryLength = historyObj.length;
        setTimeout(() => {
            historyObj.pushState({ page: 1 }, { title: 'page1' }, '/page1');
            console.log(historyObj.length-oldHistoryLength);
        }, 1000);
        setTimeout(() => {
            historyObj.pushState({ page: 2 }, { title: 'page2' }, '/page2');
            console.log(historyObj.length-oldHistoryLength);
        }, 2000);
        setTimeout(() => {
            historyObj.pushState({ page: 3 }, { title: 'page3' }, '/page3');
            console.log(historyObj.length-oldHistoryLength);
        }, 3000);
        setTimeout(() => {
            historyObj.back();
            setTimeout(()=>console.log(historyObj.length-oldHistoryLength),100);

        }, 4000);
        setTimeout(() => {
            historyObj.pushState({ page:4 }, { title: 'page4' }, '/page4');
            console.log(historyObj.length-oldHistoryLength);
        }, 5000);
        setTimeout(() => {
            historyObj.go(1);
            console.log(historyObj.length-oldHistoryLength);
        }, 6000);
    script>
body>
html>
```

## 2.基本路由 [#](#t92基本路由)

### 2.1 安装 [#](#t1021-安装)

```js
npm i react-router-dom --save
```

### 2.2 src\index.js [#](#t1122-srcindexjs)

src\index.js

```js
import React from 'react';
import ReactDOM from 'react-dom';
import {HashRouter as Router,Route} from 'react-router-dom';
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
ReactDOM.render(
    <Router>
        <div>
          <Route path="/" component={Home} exact/>
          <Route path="/user" component={User} />
          <Route path="/profile" component={Profile}/>
        div>
    Router>
,document.getElementById('root'));
```

### 2.3 Home.js [#](#t1223-homejs)

src\components\Home.js

```js
import React,{Component} from 'react';
export default class Home extends React.Component{
    render(){
        console.log(this.props);
        return (
            <div>
             <p>Homep>
             <button onClick={()=>this.props.history.push({pathname:'/user',state:{id:1}})}>跳转到/userbutton>
            div>
        )
    }
}
```

### 2.4 Home.js [#](#t1324-homejs)

src\components\User.js

```js
import React,{Component} from 'react';
export default class User extends React.Component{
    render(){
        console.log(this.props.location.state);
        return (
            <div>
                <p>Userp>
                <button onClick={()=>this.props.history.goBack()}>返回button>
            div>
        )
    }
}

```

### 2.4 Profile.js [#](#t1424-profilejs)

src\components\Profile.js

```js
import React,{Component} from 'react';
export default class Profile extends Component{
    render() {
        return (
            <div>Profilediv>
        )
    }
}
```

## 3.实现基本路由 [#](#t153实现基本路由)

### 3.1 src\index.js [#](#t1631-srcindexjs)

* [react-router-dom/modules/index.js](https://gitee.com/zhufengpeixun/react-router/blob/master/packages/react-router-dom/modules/index.js)

```diff
import React from 'react';
import ReactDOM from 'react-dom';
+import {HashRouter as Router,Route} from './react-router-dom';
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
ReactDOM.render(

,document.getElementById('root'));
```

### 3.2 RouterContext.js [#](#t1732-routercontextjs)

src\react-router\RouterContext.js

```js
import React from 'react'
export default React.createContext({});
```

### 3.3 Router.js [#](#t1833-routerjs)

src\react-router\Router.js

```js
import React from 'react'
import RouterContext from './RouterContext';
class Router extends React.Component{
    constructor(props){
        super(props);
        this.state = {
            location:props.history.location
        }

        this.unlisten = props.history.listen((location)=>{
            this.setState({location});
        });
    }
    componentWillUnmount(){
        this.unlisten&&this.unlisten();
    }
    render(){
        let value = {
            location:this.state.location,
            history:this.props.history
        }
        return (
            <RouterContext.Provider value={value}>
                {this.props.children}
            RouterContext.Provider>
        )
    }
}

export default Router;
```

### 3.4 Route.js [#](#t1934-routejs)

src\react-router\Route.js

```js
import React from 'react'
import RouterContext from './RouterContext';
class Route extends React.Component{
    static contextType = RouterContext
    render(){
        const {history,location} = this.context;
        const {path,component:RouteComponent} = this.props;
        const match = location.pathname === path;
        let routeProps = {history,location};
        let element=null;
        if(match){
            element= <RouteComponent {...routeProps}/>
        }
        return element;
    }
}
export default Route;
```

### 3.5 react-router\index.js [#](#t2035-react-routerindexjs)

src\react-router\index.js

```js
export {default as Route} from './Route';
export {default as Router} from './Router';
export {default as __RouterContext} from './RouterContext';
```

### 3.6 BrowserRouter.js [#](#t2136-browserrouterjs)

src\react-router-dom\BrowserRouter.js

```js
import React from 'react'
import {Router} from '../react-router';
import {createBrowserHistory} from 'history';

class BrowserRouter extends React.Component{

    history = createBrowserHistory(this.props)
    render(){
        return (
            <Router history={this.history}>
                {this.props.children}
            Router>
        )
    }
}
export default BrowserRouter;
```

### 3.7 HashRouter.js [#](#t2237-hashrouterjs)

src\react-router-dom\HashRouter.js

```js
import React from 'react'
import {Router} from '../react-router';
import {createHashHistory} from 'history';
class HashRouter extends React.Component{
    history = createHashHistory()
    render(){
        return (
            <Router history={this.history}>
                {this.props.children}
            Router>
        )
    }
}
export default HashRouter;
```

### 3.8 react-router-dom\index.js [#](#t2338-react-router-domindexjs)

src\react-router-dom\index.js

```js
export * from '../react-router';
export {default as HashRouter} from './HashRouter';
export {default as BrowserRouter} from './BrowserRouter';
```

## 3.实现history [#](#t243实现history)

### 3.1 createBrowserHistory.js [#](#t2531-createbrowserhistoryjs)

src\history\createBrowserHistory.js

```js
function createBrowserHistory(){
    const globalHistory = window.history;
    let listeners = [];
    let state;
    function listen(listener){
        listeners.push(listener);
        return ()=>{
            listeners = listeners.filter(item=>item!=listener);
        }
    }
    function go(n){
        globalHistory.go(n);
    }
    window.addEventListener('popstate',()=>{
        let location = {state:globalHistory.state,pathname:window.location.pathname};

        notify({action:"POP",location});
    });
    function goBack(){
        go(-1);
    }
    function goForward(){
        go(1);
    }
    function notify(newState){

        Object.assign(history,newState);
        history.length = globalHistory.length;
        listeners.forEach(listener=>listener(history.location));
    }
    function push(pathname,nextState){
        const action = 'PUSH';
        if(typeof pathname === 'object'){
            state = pathname.state;
            pathname = pathname.pathname;
        }else{
            state=nextState;
        }
        globalHistory.pushState(state,null,pathname);
        let location = {state,pathname};
        notify({action,location});
    }
    const history = {
        action:'POP',
        go,
        goBack,
        goForward,
        push,
        listen,
        location:{pathname:window.location.pathname,state:window.location.state}
    }
    return history;
}
export default createBrowserHistory;
```

### 3.2 createHashHistory.js [#](#t2632-createhashhistoryjs)

src\history\createHashHistory.js

```js

function createHashHistory(){
    let stack = [];
    let index = -1;
    let action = 'POP';
    let state ;
    let listeners = [];
    function listen(listener){
        listeners.push(listener);
        return ()=>{
            listeners = listeners.filter(item=>item!=listener);
        }
    }
    function go(n){
        action = 'POP';
        index+=n;
        let nextLocation = stack[index];
        state= nextLocation.state;
        window.location.hash = nextLocation.pathname;
    }
    let hashChangeHandler = ()=>{
        let pathname = window.location.hash.slice(1);
        Object.assign(history,{action,location:{pathname,state}});
        if(action === 'PUSH'){
            stack[++index]=history.location;
        }
        listeners.forEach(listener=>listener(history.location));
    }
    function push(pathname,nextState){
        action = 'PUSH';
        if(typeof pathname ==='object'){
            state = pathname.state;
            pathname = pathname.pathname
        }else{
            state = nextState;
        }
        window.location.hash = pathname;
    }

    window.addEventListener('hashchange',hashChangeHandler);
    function goBack(){
        go(-1);
    }
    function goForward(){
        go(1);
    }
    const history = {
        action:'POP',
        go,
        goBack,
        goForward,
        push,
        listen,
        location:{},
        location:{pathname:'/',state:undefined}
    }
    if(window.location.hash){
        action = 'PUSH';
        hashChangeHandler();
    }else{
        window.location.hash = '/';
    }
    return history;
}
export default createHashHistory;
```

### 3.3 history\index.js [#](#t2733-historyindexjs)

src\history\index.js

```js
export {default as createBrowserHistory} from './createBrowserHistory';
export {default as createHashHistory} from './createHashHistory';
```

### 3.4 BrowserRouter.js [#](#t2834-browserrouterjs)

src\react-router-dom\BrowserRouter.js

```diff
import React from 'react'
import {Router} from '../react-router';
+import {createBrowserHistory} from '../history';
//创建相应的历史对象，并且传入Router组件，原样渲染子组件
class BrowserRouter extends React.Component{
    //不管是哪种创建历史对象的方法，得到的history 长的都一样，都像window.history
    history = createBrowserHistory(this.props)//window.history
    render(){
        return (

                {this.props.children}

        )
    }
}
export default BrowserRouter;
```

### 3.5 HashRouter.js [#](#t2935-hashrouterjs)

src\react-router-dom\HashRouter.js

```diff
import React from 'react'
import {Router} from '../react-router';
import {createHashHistory} from '../history';
class HashRouter extends React.Component{
    history = createHashHistory()//hash实现
    render(){
        return (

                {this.props.children}

        )
    }
}
export default HashRouter;
```

## 4. path-to-regexp [#](#t304-path-to-regexp)

* [regulex](https://jex.im/regulex)
* [path-to-regexp](https://www.npmjs.com/package/path-to-regexp)
  - sensitive 是否大小写敏感 (默认值: false)
  - strict 是否允许结尾有一个可选的/ (默认值: false)
  - end 是否匹配整个字符串 (默认值: true)

### 4.1 /home结束 [#](#t3141-home结束)

```js
let pathToRegExp = require('path-to-regexp');
let regxp = pathToRegExp('/home',[],{end:true});
console.log(regxp);
console.log(regxp.test('/home'));
console.log(regxp.test('/home/2'));
```

![](http://img.zhufengpeixun.cn/homereg.png)

### 4.2 /home非结束 [#](#t3242-home非结束)

```js
let pathToRegExp = require('path-to-regexp');
let regExp = pathToRegExp('/home',[],{end:false});
console.log(regExp);
console.log(regExp.test('/home'));
console.log(regExp.test('/home/'));
console.log(regExp.test('/home//'));
console.log(regExp.test('/home/2'));
```

![](http://img.zhufengpeixun.cn/homereg2.png)

### 4.3 路径参数 [#](#t3343-路径参数)

```js
let params = [];
let regExp = pathToRegExp('/user/:id',params,{end:true});
console.log(regExp,params);

```

![](http://img.zhufengpeixun.cn/uerreg.png)useLocation

### 4.4 正则匹配 [#](#t3444-正则匹配)

* 是否捕获

表达式 含义 () 表示捕获分组，()会把每个分组里的匹配的值保存起来，使用$n(n是一个数字，表示第n个捕获组的内容) (?:) 表示非捕获分组，和捕获分组唯一的区别在于，非捕获分组匹配的值不会保存起来 `(?<name>...)</name>`

表示命名捕获分组,反向引用一个命名分组的语法是 ``\k<name>`</name>``

,在

replace() `&#x65B9;&#x6CD5;&#x7684;&#x66FF;&#x6362;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x53CD;&#x5411;&#x5F15;&#x7528;&#x662F;&#x7528;`

$`

```js

console.log('1ab'.match(/1[a-z]([b-c])/));

console.log('1ab'.match(/1[a-z](?:[a-z])/));

console.log(/(?\d{2})-(?\d{2})/.exec('11-22'));
console.log('11-22'.replace(/(?\d{2})-(?\d{2})/,"$-$"));
```

* 前瞻和后顾

表达式 含义 (?=pattern) 正向肯定查找(前瞻),后面必须跟着什么 (?!pattern) 正向否定查找(前瞻)，后面不能跟着什么 ``(?<=pattern)< code><p class="node-read-div2p"> &#x53CD;&#x5411;&#x80AF;&#x5B9A;&#x6761;&#x4EF6;&#x67E5;&#x627E;(&#x540E;&#x987E;),&#x4E0D;&#x6355;&#x83B7; </p><code>(?<!pattern)</code><p class="node-read-div2p"> &#x53CD;&#x5411;&#x5426;&#x5B9A;&#x6761;&#x4EF6;&#x67E5;&#x627E;&#xFF08;&#x540E;&#x987E;&#xFF09;</p><pre><code class="lang-js">

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'1a'</span>.match(<span class="hljs-regexp">/\d(?=[a-z])[a-z]/</span>));

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'1a'</span>.match(<span class="hljs-regexp">/\d(?![A-Z])[a-z]/</span>));

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'1a'</span>.match(<span class="hljs-regexp">/(?<=[a-z])\d[a-z] < span>));

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'1a'</span>.match(<span class="hljs-regexp">/(?<![A-Z])\d[a-z]/</span>));

<span class="hljs-keyword">let</span> array = [<span class="hljs-string">'1ab'</span>];
array.index = <span class="hljs-number">0</span>;
array.input = <span class="hljs-string">'1ab'</span>;
array.groups = <span class="hljs-literal">undefined</span>;
<span class="hljs-built_in">console</span>.log(array);
</span></=[a-z])\d[a-z]></span></code></pre><h2 id="t355. &#x6B63;&#x5219;&#x5339;&#x914D;">5. &#x6B63;&#x5219;&#x5339;&#x914D; <a href="#t355. &#x6B63;&#x5219;&#x5339;&#x914D;">#</a></h2><h3 id="t365.1 matchPath.js">5.1 matchPath.js <a href="#t365.1 matchPath.js">#</a></h3><p>src\react-router\matchPath.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> pathToRegexp <span class="hljs-keyword">from</span> <span class="hljs-string">'path-to-regexp'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compilePath</span>(<span class="hljs-params">path,options</span>)</span>{
    <span class="hljs-keyword">const</span> keys = [];
    <span class="hljs-keyword">const</span> regexp = pathToRegexp(path,keys,options);
    <span class="hljs-keyword">return</span> {keys,regexp};
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matchPath</span>(<span class="hljs-params">pathname,options = {}</span>)</span>{
    <span class="hljs-keyword">let</span> {path=<span class="hljs-string">'/'</span>,exact=<span class="hljs-literal">false</span>,strict=<span class="hljs-literal">false</span>,sensitive=<span class="hljs-literal">false</span>}=options;
    <span class="hljs-keyword">let</span> {keys,regexp} = compilePath(path,{
        <span class="hljs-attr">end</span>:exact,
        strict,
        sensitive
    });
    <span class="hljs-keyword">const</span> match = regexp.exec(pathname);
    <span class="hljs-keyword">if</span>(!match) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> [url,...values] = match;

    <span class="hljs-keyword">const</span> isExact = pathname === url;

    <span class="hljs-keyword">if</span>(exact && !isExact) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> {
        path,
        url,
        isExact,
        <span class="hljs-attr">params</span>:keys.reduce(<span class="hljs-function">(<span class="hljs-params">memo,key,index</span>)=></span>{
            memo[key.name] = values[index];
            <span class="hljs-keyword">return</span> memo;
        },{})
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> matchPath;
</code></pre><h3 id="t375.2 Router.js">5.2 Router.js <a href="#t375.2 Router.js">#</a></h3><p>src\react-router\Router.js</p><pre><code class="lang-diff">import React from 'react'
import RouterContext from './RouterContext';
class Router extends React.Component{
<span class="hljs-addition">+    static computeRootMatch(pathname) {</span>
<span class="hljs-addition">+        return { path: "/", url: "/", params: {}, isExact: pathname === "/" };</span>
<span class="hljs-addition">+    }</span>
    constructor(props){
        super(props);
        this.state = {
            location:props.history.location
        }
        //&#x5F53;&#x8DEF;&#x5F84;&#x53D1;&#x751F;&#x7684;&#x53D8;&#x5316;&#x7684;&#x65F6;&#x5019;&#x6267;&#x884C;&#x56DE;&#x8C03;
        this.unlisten = props.history.listen((location)=>{
            this.setState({location});
        });
    }
    componentWillUnmount(){
        this.unlisten&&this.unlisten();
    }
    render(){
        let value = {//&#x901A;&#x8FC7;value&#x5411;&#x4E0B;&#x5C42;&#x4F20;&#x9012;&#x6570;&#x636E;
            location:this.state.location,
            history:this.props.history,
<span class="hljs-addition">+            match: Router.computeRootMatch(this.state.location.pathname)</span>
        }
        return (
            <routercontext.provider value="{value}">
                {this.props.children}
            </routercontext.provider>
        )
    }
}

export default Router;
</code></pre><h3 id="t385.3 Route.js">5.3 Route.js <a href="#t385.3 Route.js">#</a></h3><p>src\react-router\Route.js</p><pre><code class="lang-diff">import React from 'react'
import RouterContext from './RouterContext';
<span class="hljs-addition">+import matchPath from './matchPath';</span>
class Route extends React.Component{
    static contextType = RouterContext
    render(){
        const {history,location} = this.context;
        const {component:RouteComponent} = this.props;
<span class="hljs-addition">+        const match = matchPath(location.pathname, this.props);</span>
        let routeProps = {history,location};
        let element=null;
        if (match) {
<span class="hljs-addition">+           routeProps.match = match;</span>
            element = <routecomponent {...routeprops}>
        }
        return (
            <routercontext.provider value="{routeProps}">
                {element}
            </routercontext.provider>
        )
    }
}
export default Route;
</routecomponent></code></pre><h3 id="t395.4 react-router\index.js">5.4 react-router\index.js <a href="#t395.4 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from './Route';
export {default as Router} from './Router';
export {default as __RouterContext} from './RouterContext';
<span class="hljs-addition">+export {default as matchPath} from './matchPath';</span>
</code></pre><h2 id="t406. &#x5B9E;&#x73B0;Switch">6. &#x5B9E;&#x73B0;Switch <a href="#t406. &#x5B9E;&#x73B0;Switch">#</a></h2><h3 id="t416.1 Switch.js">6.1 Switch.js <a href="#t416.1 Switch.js">#</a></h3><p>src\react-router\Switch.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">'./RouterContext'</span>;
<span class="hljs-keyword">import</span> matchPath <span class="hljs-keyword">from</span> <span class="hljs-string">'./matchPath'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Switch</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">static</span> contextType = RouterContext
    render() {
        <span class="hljs-keyword">const</span> { location } = <span class="hljs-keyword">this</span>.context;
        <span class="hljs-keyword">let</span> element, match;
        React.Children.forEach(<span class="hljs-keyword">this</span>.props.children, child => {
            <span class="hljs-keyword">if</span> (!match && React.isValidElement(child)) {
                element = child;
                match = matchPath(location.pathname, child.props);
            }
        });
        <span class="hljs-keyword">return</span> match ? React.cloneElement(element, {<span class="hljs-attr">computedMatch</span>: match }) : <span class="hljs-literal">null</span>
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Switch;
</code></pre><h3 id="t426.2 Route.js">6.2 Route.js <a href="#t426.2 Route.js">#</a></h3><p>src\react-router\Route.js</p><pre><code class="lang-diff">import React from 'react'
import RouterContext from './RouterContext';
import matchPath from './matchPath';
class Route extends React.Component{
    static contextType = RouterContext
    render(){
        const {history,location} = this.context;
<span class="hljs-addition">+        const {component:RouteComponent,computedMatch} = this.props;</span>
<span class="hljs-addition">+        const match = computedMatch ? computedMatch : matchPath(location.pathname, this.props);</span>
        let routeProps = {history,location};
        let element=null;
        if (match) {
            routeProps.match = match;
            element = <routecomponent {...routeprops}>
        }
        return (
            <routercontext.provider value="{routeProps}">
                {element}
            </routercontext.provider>
        )
    }
}
export default Route;
</routecomponent></code></pre><h3 id="t436.3 react-router\index.js">6.3 react-router\index.js <a href="#t436.3 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from './Route';
export {default as Router} from './Router';
export {default as __RouterContext} from './RouterContext';
export {default as matchPath} from './matchPath';
<span class="hljs-addition">+export {default as Switch} from './Switch';</span>
</code></pre><h3 id="t446.4 src\index.js">6.4 src\index.js <a href="#t446.4 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from 'react';
import ReactDOM from 'react-dom';
import {HashRouter as Router,Route,Switch} from './react-router-dom';
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
ReactDOM.render(
    <router>
<span class="hljs-addition">+        <switch></switch></span>
          <route path="/" component="{Home}" exact>
          <route path="/user" component="{User}">
          <route path="/profile" component="{Profile}/">
<span class="hljs-addition">+        </span>
    </route></route></route></router>
,document.getElementById('root'));
</code></pre><h2 id="t457. Redirect">7. Redirect <a href="#t457. Redirect">#</a></h2><h3 id="t467.1 Redirect.js">7.1 Redirect.js <a href="#t467.1 Redirect.js">#</a></h3><p>src\react-router\Redirect.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">'./RouterContext'</span>;
<span class="hljs-keyword">import</span> Lifecycle <span class="hljs-keyword">from</span> <span class="hljs-string">'./Lifecycle'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Redirect</span>(<span class="hljs-params">{to}</span>)</span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">RouterContext.Consumer</span>></span>
            {
                contextValue=>{
                    const {history}= contextValue;
                    return (
                        <span class="hljs-tag"><<span class="hljs-name">Lifecycle</span>
                           <span class="hljs-attr">onMount</span>=<span class="hljs-string">{()</span>=></span>history.push(to)}
                        />
                    );
                }
            }
        <span class="hljs-tag">RouterContext.Consumer</span>></span>
    );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Redirect;
</code></pre><h3 id="t477.2 Lifecycle.js">7.2 Lifecycle.js <a href="#t477.2 Lifecycle.js">#</a></h3><p>src\react-router\Lifecycle.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lifecycle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    componentDidMount(){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.props.onMount)
            <span class="hljs-keyword">this</span>.props.onMount(<span class="hljs-keyword">this</span>);
    }
    componentWillUnmount(){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.props.onUnmount)
            <span class="hljs-keyword">this</span>.props.onUnmount(<span class="hljs-keyword">this</span>);
    }
    render(){
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Lifecycle;
</code></pre><h3 id="t487.3 react-router\index.js">7.3 react-router\index.js <a href="#t487.3 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from './Route';
export {default as Router} from './Router';
export {default as __RouterContext} from './RouterContext';
export {default as matchPath} from './matchPath';
export {default as Switch} from './Switch';
<span class="hljs-addition">+export {default as Redirect} from './Redirect';</span>
</code></pre><h3 id="t497.4 src\index.js">7.4 src\index.js <a href="#t497.4 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from 'react';
import ReactDOM from 'react-dom';
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect} from './react-router-dom';</span>
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
ReactDOM.render(
    <router>
        <switch>
          <route path="/" component="{Home}" exact>
          <route path="/user" component="{User}">
          <route path="/profile" component="{Profile}/">
<span class="hljs-addition">+         <redirect to="/"></redirect></span>
        </route></route></route></switch>
    </router>
,document.getElementById('root'));
</code></pre><p>src\react-router-dom\Link.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {__RouterContext <span class="hljs-keyword">as</span> RouterContext} <span class="hljs-keyword">from</span> <span class="hljs-string">'../react-router'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Link</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">RouterContext.Consumer</span>></span>
            {
                contextValue=>{
                    return (
                        <span class="hljs-tag"><<span class="hljs-name">a</span>
                           {<span class="hljs-attr">...props</span>}
                           <span class="hljs-attr">onClick</span>=<span class="hljs-string">{(event)</span>=></span>{
                              event.preventDefault();
                              contextValue.history.push(props.to);
                           }}
                        >{props.children}<span class="hljs-tag">a</span>></span>
                    )
                }
            }
        <span class="hljs-tag">RouterContext.Consumer</span>>
    )
}
</code></pre><h3 id="t528.2 react-router-dom\index.js">8.2 react-router-dom\index.js <a href="#t528.2 react-router-dom\index.js">#</a></h3><p>src\react-router-dom\index.js</p><pre><code class="lang-diff">export * from '../react-router';
export {default as HashRouter} from './HashRouter';
export {default as BrowserRouter} from './BrowserRouter';
<span class="hljs-addition">+export {default as Link} from './Link';</span>
</code></pre><h3 id="t538.3 src\index.js">8.3 src\index.js <a href="#t538.3 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from 'react';
import ReactDOM from 'react-dom';
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect,Link} from './react-router-dom';</span>
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
ReactDOM.render(
    <router>
<span class="hljs-addition">+      </span>
<span class="hljs-addition">+          <li><link to="/">&#x9996;&#x9875;</li></span>
<span class="hljs-addition">+          <li><link to="/user">&#x7528;&#x6237;&#x7BA1;&#x7406;</li></span>
<span class="hljs-addition">+          <li><link to="/profile">&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;</li></span>
<span class="hljs-addition">+      </span>
        <switch>
          <route path="/" component="{Home}" exact>
          <route path="/user" component="{User}">
          <route path="/profile" component="{Profile}/">
          <redirect to="/">
        </redirect></route></route></route></switch>
    </router>
,document.getElementById('root'));
</code></pre><h2 id="t549.&#x5D4C;&#x5957;&#x8DEF;&#x7531;">9.&#x5D4C;&#x5957;&#x8DEF;&#x7531; <a href="#t549.&#x5D4C;&#x5957;&#x8DEF;&#x7531;">#</a></h2><h3 id="t559.1 utils.js">9.1 utils.js <a href="#t559.1 utils.js">#</a></h3><p>src\utils.js</p><pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> UserAPI = {
    list(){
        <span class="hljs-keyword">let</span> usersStr = localStorage.getItem(<span class="hljs-string">'users'</span>);
        <span class="hljs-keyword">let</span> users= usersStr ? <span class="hljs-built_in">JSON</span>.parse(usersStr) : [];
        <span class="hljs-keyword">return</span> users;
    },
    add(user){
        <span class="hljs-keyword">let</span> users = UserAPI.list();
        users.push(user);
        localStorage.setItem(<span class="hljs-string">'users'</span>, <span class="hljs-built_in">JSON</span>.stringify(users));
    },
    find(id){
        <span class="hljs-keyword">let</span> users = UserAPI.list();
        <span class="hljs-keyword">return</span> users.find(<span class="hljs-function">(<span class="hljs-params">user</span>) =></span> user.id === id);
    }
}
</code></pre><h3 id="t569.2 User.js">9.2 User.js <a href="#t569.2 User.js">#</a></h3><p>src\components\User.js</p><pre><code class="lang-diff">import React from 'react';
import { Link, Route } from '../react-router-dom';
<span class="hljs-addition">+import UserAdd from './UserAdd';</span>
<span class="hljs-addition">+import UserDetail from './UserDetail';</span>
<span class="hljs-addition">+import UserList from './UserList';</span>
export default function User() {
    return (
<span class="hljs-addition">+        </span>
<span class="hljs-addition">+             </span>
<span class="hljs-addition">+                    <li><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li></span>
<span class="hljs-addition">+                    <li><link to="/user/add">&#x6DFB;&#x52A0;&#x7528;&#x6237;</li></span>
<span class="hljs-addition">+                </span>
<span class="hljs-addition">+            </span>
<span class="hljs-addition">+                <route path="/user/add" component="{UserAdd}"></route></span>
<span class="hljs-addition">+                <route path="/user/list" component="{UserList}"></route></span>
<span class="hljs-addition">+                <route path="/user/detail/:id" component="{UserDetail}"></route></span>
<span class="hljs-addition">+            </span>
<span class="hljs-addition">+        </span>
    )
}
</code></pre><h3 id="t579.3 UserAdd.js">9.3 UserAdd.js <a href="#t579.3 UserAdd.js">#</a></h3><p>src\components\UserAdd.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {UserAPI} <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserAdd</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    usernameRef
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.usernameRef = React.createRef();
    }
    handleSubmit = <span class="hljs-function">(<span class="hljs-params">event</span>) =></span> {
        event.preventDefault();
        <span class="hljs-keyword">let</span> username = <span class="hljs-keyword">this</span>.usernameRef.current.value;
        UserAPI.add({ <span class="hljs-attr">id</span>: <span class="hljs-built_in">Date</span>.now() + <span class="hljs-string">''</span>, username });
        <span class="hljs-keyword">this</span>.props.history.push(<span class="hljs-string">'/user/list'</span>);
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag"><<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{this.handleSubmit}</span>></span>
                <span class="hljs-tag"><<span class="hljs-name">input</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.usernameRef}</span> /></span>
                <span class="hljs-tag"><<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> ></span>&#x63D0;&#x4EA4;<span class="hljs-tag">button</span>></span>
            <span class="hljs-tag">form</span>>
        )
    }
}
</code></pre><h3 id="t589.4 UserList.js">9.4 UserList.js <a href="#t589.4 UserList.js">#</a></h3><p>src\components\UserList.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { Link } <span class="hljs-keyword">from</span> <span class="hljs-string">'../react-router-dom'</span>;
<span class="hljs-keyword">import</span> {UserAPI} <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    state = { <span class="hljs-attr">users</span>: [] }
    componentDidMount() {
        <span class="hljs-keyword">let</span> users = UserAPI.list();
        <span class="hljs-keyword">this</span>.setState({ users });
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag"><<span class="hljs-name">ul</span> ></span>
                {
                    this.state.users.map((user, index) => (
                        <span class="hljs-tag"><<span class="hljs-name">li</span>  <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>></span>
                            <span class="hljs-tag"><<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">pathname:</span> `/<span class="hljs-attr">user</span>/<span class="hljs-attr">detail</span>/${<span class="hljs-attr">user.id</span>}`, <span class="hljs-attr">state:</span> <span class="hljs-attr">user</span> }}></span>{user.username}<span class="hljs-tag">Link</span>></span>
                        <span class="hljs-tag">li</span>>
                    ))
                }
            <span class="hljs-tag">ul</span>>
        )
    }
}
</code></pre><h3 id="t599.5 UserDetail.js">9.5 UserDetail.js <a href="#t599.5 UserDetail.js">#</a></h3><p>src\components\UserDetail.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {UserAPI} <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDetail</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    state = {
        <span class="hljs-attr">user</span>: {}
    }
    componentDidMount() {
        <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">this</span>.props.location.state;
        <span class="hljs-keyword">if</span> (!user) {
            <span class="hljs-keyword">let</span> id = <span class="hljs-keyword">this</span>.props.match.params.id;
            user = UserAPI.find(id);
        }
        <span class="hljs-keyword">if</span> (user) <span class="hljs-keyword">this</span>.setState({ user });
    }
    render() {
        <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">this</span>.state.user;
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>
                {user.id}:{user.username}
            <span class="hljs-tag">div</span>></span>
        )
    }
}
</code></pre><h2 id="t6010.&#x53D7;&#x4FDD;&#x62A4;&#x8DEF;&#x7531;">10.&#x53D7;&#x4FDD;&#x62A4;&#x8DEF;&#x7531; <a href="#t6010.&#x53D7;&#x4FDD;&#x62A4;&#x8DEF;&#x7531;">#</a></h2><h3 id="t6110.1 src\index.js">10.1 src\index.js <a href="#t6110.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from 'react';
import ReactDOM from 'react-dom';
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect,Link} from './react-router-dom';</span>
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
<span class="hljs-addition">+import Protected from './components/Protected';</span>
<span class="hljs-addition">+import Login from './components/Login';</span>
ReactDOM.render(
    <router>
      <ul>
          <li><link to="/">&#x9996;&#x9875;</li>
          <li><link to="/user">&#x7528;&#x6237;&#x7BA1;&#x7406;</li>
          <li><link to="/profile">&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;</li>
      </ul>
        <switch>
          <route path="/" component="{Home}" exact>
          <route path="/user" component="{User}">
<span class="hljs-addition">+         <protected path="/profile" component="{Profile}/"></protected></span>
<span class="hljs-addition">+         <route path="/login" component="{Login}/"></route></span>
          <redirect to="/">
        </redirect></route></route></switch>
    </router>
,document.getElementById('root'));
</code></pre><h3 id="t6210.2 Route.js">10.2 Route.js <a href="#t6210.2 Route.js">#</a></h3><p>src\react-router\Route.js</p><pre><code class="lang-diff">import React from 'react'
import RouterContext from './RouterContext';
import matchPath from './matchPath';
class Route extends React.Component{
    static contextType = RouterContext
    render(){
        const {history,location} = this.context;
<span class="hljs-addition">+       const {component:RouteComponent,computedMatch,render} = this.props;</span>
        const match = computedMatch ? computedMatch : matchPath(location.pathname, this.props);
        let routeProps = {history,location};
        let element=null;
<span class="hljs-addition">+       if (match) {</span>
<span class="hljs-addition">+           routeProps.match = match;</span>
<span class="hljs-addition">+           if (RouteComponent) {</span>
<span class="hljs-addition">+               element = <routecomponent {...routeprops}></routecomponent></span>
<span class="hljs-addition">+           } else if (render) {</span>
<span class="hljs-addition">+               element=  render(routeProps);</span>
<span class="hljs-addition">+           } else {</span>
<span class="hljs-addition">+               element=  null;</span>
<span class="hljs-addition">+           }</span>
<span class="hljs-addition">+       }else {</span>
<span class="hljs-addition">+            element=  null;</span>
<span class="hljs-addition">+       }</span>
        return (
            <routercontext.provider value="{routeProps}">
                {element}
            </routercontext.provider>
        )
    }
}
export default Route;
</code></pre><h3 id="t6310.3 Login.js">10.3 Login.js <a href="#t6310.3 Login.js">#</a></h3><p>src\components\Login.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Login</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    login = <span class="hljs-function"><span class="hljs-params">()</span>=></span>{
        localStorage.setItem(<span class="hljs-string">'login'</span>,<span class="hljs-string">'true'</span>);
        <span class="hljs-keyword">let</span> to=<span class="hljs-string">'/'</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.props.location.state){
            to=<span class="hljs-keyword">this</span>.props.location.state.from||<span class="hljs-string">'/'</span>;
        }
        <span class="hljs-keyword">this</span>.props.history.push(to);
    }
    render(){
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag"><<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.login}</span>></span>&#x767B;&#x5F55;<span class="hljs-tag">button</span>></span>
        )
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Login;
</code></pre><h3 id="t6410.4 Protected.js">10.4 Protected.js <a href="#t6410.4 Protected.js">#</a></h3><p>src\components\Protected.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {Route,Redirect} <span class="hljs-keyword">from</span> <span class="hljs-string">'../react-router-dom'</span>;
<span class="hljs-keyword">const</span> Protected =  <span class="hljs-function">(<span class="hljs-params">props</span>)=></span>{
    <span class="hljs-keyword">let</span> {<span class="hljs-attr">component</span>:RouteComponent,path} = props;
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">{path}</span> <span class="hljs-attr">render</span>=<span class="hljs-string">{</span>
            (<span class="hljs-attr">routeProps</span>)=></span>(
                localStorage.getItem('login')?<span class="hljs-tag"><<span class="hljs-name">RouteComponent</span> {<span class="hljs-attr">...routeProps</span>}/></span>:
                <span class="hljs-tag"><<span class="hljs-name">Redirect</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{{pathname:</span>'/<span class="hljs-attr">login</span>',<span class="hljs-attr">state:</span>{<span class="hljs-attr">from:path</span>}}}/></span>
            )
        }/></span>
    )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Protected;
</code></pre><h3 id="t6611.1 public\index.html">11.1 public\index.html <a href="#t6611.1 public\index.html">#</a></h3><p>public\index.html</p><pre><code class="lang-diff"><!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Web site created using create-react-app">
    <title>React App</title>
    <style>
<span class="hljs-addition">+      .strong{</span>
<span class="hljs-addition">+        font-size: 20px;</span>
<span class="hljs-addition">+      }</span>
<span class="hljs-addition">+      .active{</span>
<span class="hljs-addition">+        background-color: green;</span>
<span class="hljs-addition">+      }</span>
    </style>
  </head>
  <body>

  </body>
</html>
</code></pre><h3 id="t6711.2 src\index.js">11.2 src\index.js <a href="#t6711.2 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from 'react';
import ReactDOM from 'react-dom';
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect,NavLink} from './react-router-dom';</span>
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
import Protected from './components/Protected';
import Login from './components/Login';
ReactDOM.render(
    <router>
      <ul>
<span class="hljs-addition">+        <li><navlink classname="strong" style="{{textDecoration:" 'line-through'}} activestyle="{{color:'red'}}" to="/" exact>Home</navlink></li></span>
<span class="hljs-addition">+        <li><navlink activestyle="{{color:'red'}}" to="/user">User</navlink></li></span>
<span class="hljs-addition">+        <li><navlink activestyle="{{color:'red'}}" to="/profile">Profile</navlink></li></span>
      </ul>
        <switch>
          <route path="/" component="{Home}" exact>
          <route path="/user" component="{User}">
          <protected path="/profile" component="{Profile}/">
          <route path="/login" component="{Login}/">
          <redirect to="/">
        </redirect></route></protected></route></route></switch>
    </router>
,document.getElementById('root'));
</code></pre><p>src\react-router-dom\NavLink.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {Route} <span class="hljs-keyword">from</span> <span class="hljs-string">'../react-router'</span>;
<span class="hljs-keyword">import</span> matchPath <span class="hljs-keyword">from</span> <span class="hljs-string">'../react-router/matchPath'</span>;
<span class="hljs-keyword">import</span> Link <span class="hljs-keyword">from</span> <span class="hljs-string">'./Link'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NavLink</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">const</span> {
        <span class="hljs-attr">to</span>:path,
        <span class="hljs-attr">className</span>:classNameProp=<span class="hljs-string">''</span>,
        <span class="hljs-attr">style</span>:styleProp={},
        activeClassName=<span class="hljs-string">'active'</span>,
        activeStyle={},
        children,
        exact
    }= props;
     <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">{path}</span> <span class="hljs-attr">exact</span>=<span class="hljs-string">{exact}</span>></span>
            {
                ({match})=>{
                    let className = match?joinClassNames(classNameProp,activeClassName):classNameProp;
                    let style =match?{...styleProp,...activeStyle}:styleProp;
                    let linkProps = {
                        className,
                        style,
                        to:path,
                        children
                    }
                    return <span class="hljs-tag"><<span class="hljs-name">Link</span> {<span class="hljs-attr">...linkProps</span>}/></span>
                }
            }
        <span class="hljs-tag">Route</span>></span>
     )
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NavLink</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">let</span> context = React.useContext(RouterContext);
    <span class="hljs-keyword">let</span> {<span class="hljs-attr">location</span>:{pathname}}= context;
    <span class="hljs-keyword">const</span> {
        <span class="hljs-attr">to</span>:path,
        <span class="hljs-attr">className</span>:classNameProp=<span class="hljs-string">''</span>,
        <span class="hljs-attr">style</span>:styleProp={},
        activeClassName=<span class="hljs-string">'active'</span>,
        activeStyle={},
        children,
        exact
    }= props;

    <span class="hljs-keyword">let</span> isActive = matchPath(pathname,{path,exact});
    <span class="hljs-keyword">let</span> className = isActive?joinClassNames(classNameProp,activeClassName):classNameProp;
    <span class="hljs-keyword">let</span> style = isActive?{...styleProp,...activeStyle}:styleProp;
    <span class="hljs-keyword">let</span> linkProps = {
        className,
        style,
        <span class="hljs-attr">to</span>:path,
        children
    }
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Link</span> {<span class="hljs-attr">...linkProps</span>}/></span></span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">joinClassNames</span>(<span class="hljs-params">...classnames</span>)</span>{
  <span class="hljs-keyword">return</span> classnames.filter(<span class="hljs-function"><span class="hljs-params">c</span>=></span>c).join(<span class="hljs-string">' '</span>);
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> NavLink;
</code></pre><h3 id="t6911.4 react-router-dom\index.js">11.4 react-router-dom\index.js <a href="#t6911.4 react-router-dom\index.js">#</a></h3><p>src\react-router-dom\index.js</p><pre><code class="lang-diff">export * from '../react-router';
export {default as HashRouter} from './HashRouter';
export {default as BrowserRouter} from './BrowserRouter';
export {default as Link} from './Link';
<span class="hljs-addition">+export { default as NavLink } from "./NavLink";</span>
</code></pre><h2 id="t7012.withRouter">12.withRouter <a href="#t7012.withRouter">#</a></h2><h3 id="t7112.1 src\index.js">12.1 src\index.js <a href="#t7112.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from 'react';
import ReactDOM from 'react-dom';
import {HashRouter as Router,Route,Switch,Redirect,NavLink} from './react-router-dom';
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
import Protected from './components/Protected';
import Login from './components/Login';
<span class="hljs-addition">+import NavHeader from './components/NavHeader';</span>
ReactDOM.render(
    <router>
      <>
<span class="hljs-addition">+      <navheader title="&#x6B22;&#x8FCE;&#x5149;&#x4E34;"></navheader></span>
      <ul>
        <li><navlink classname="strong" style="{{textDecoration:" 'line-through'}} activestyle="{{color:'red'}}" to="/" exact>Home</navlink></li>
        <li><navlink activestyle="{{color:'red'}}" to="/user">User</navlink></li>
        <li><navlink activestyle="{{color:'red'}}" to="/profile">Profile</navlink></li>
      </ul>
      <switch>
          <route path="/" component="{Home}" exact>
          <route path="/user" component="{User}">
          <protected path="/profile" component="{Profile}/">
          <route path="/login" component="{Login}/">
          <redirect to="/">
      </redirect></route></protected></route></route></switch>
      </>
    </router>
,document.getElementById('root'));
</code></pre><p>src\components\NavHeader.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {withRouter} <span class="hljs-keyword">from</span> <span class="hljs-string">'../react-router-dom'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NavHeader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    render(){
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=></span>this.props.history.push('/')} >{this.props.title}<span class="hljs-tag">div</span>></span>
        )
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> withRouter(NavHeader);
</code></pre><h3 id="t7312.3 withRouter.js">12.3 withRouter.js <a href="#t7312.3 withRouter.js">#</a></h3><p>src\react-router\withRouter.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">'./RouterContext'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withRouter</span>(<span class="hljs-params">OldComponent</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">props</span> =></span> {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag"><<span class="hljs-name">RouterContext.Consumer</span>></span>
                {
                    contextValue =>{
                        return <span class="hljs-tag"><<span class="hljs-name">OldComponent</span> {<span class="hljs-attr">...props</span>} {<span class="hljs-attr">...contextValue</span>}/></span>
                    }
                }
            <span class="hljs-tag">RouterContext.Consumer</span>></span>
        )
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> withRouter;
</code></pre><h3 id="t7412.4 react-router\index.js">12.4 react-router\index.js <a href="#t7412.4 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from './Route';
export {default as Router} from './Router';
export {default as __RouterContext} from './RouterContext';
export {default as matchPath} from './matchPath';
export {default as Switch} from './Switch';
export {default as Redirect} from './Redirect';
<span class="hljs-addition">+export {default as withRouter} from './withRouter';</span>
</code></pre><h2 id="t7513.Prompt">13.Prompt <a href="#t7513.Prompt">#</a></h2><h3 id="t7613.1 src\index.js">13.1 src\index.js <a href="#t7613.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from 'react';
import ReactDOM from 'react-dom';
<span class="hljs-addition">+import {BrowserRouter as Router,Route,Switch,Redirect,NavLink} from './react-router-dom';</span>
import Home from './components/Home';
import User from './components/User';
import Profile from './components/Profile';
import Protected from './components/Protected';
import Login from './components/Login';
import NavHeader from './components/NavHeader';
ReactDOM.render(
<span class="hljs-addition">+    <router getuserconfirmation="{()=">window.confirm}></router></span>
      <>
      <navheader title="&#x6B22;&#x8FCE;&#x5149;&#x4E34;">
      <ul>
        <li><navlink classname="strong" style="{{textDecoration:" 'line-through'}} activestyle="{{color:'red'}}" to="/" exact>Home</navlink></li>
        <li><navlink activestyle="{{color:'red'}}" to="/user">User</navlink></li>
        <li><navlink activestyle="{{color:'red'}}" to="/profile">Profile</navlink></li>
      </ul>
      <switch>
          <route path="/" component="{Home}" exact>
          <route path="/user" component="{User}">
          <protected path="/profile" component="{Profile}/">
          <route path="/login" component="{Login}/">
          <redirect to="/">
      </redirect></route></protected></route></route></switch>
      </>

,document.getElementById('root'));
</navheader></code></pre><h3 id="t7713.2 UserAdd.js">13.2 UserAdd.js <a href="#t7713.2 UserAdd.js">#</a></h3><p>src\components\UserAdd.js</p><pre><code class="lang-diff">import React, { Component } from 'react';
import {UserAPI} from '../utils';
import {Prompt} from '../react-router-dom';
export default class UserAdd extends Component {
    usernameRef
<span class="hljs-addition">+    state = {isBlocking:false}</span>
    constructor(props) {
        super(props);
        this.usernameRef = React.createRef();
    }
    handleSubmit = (event) => {
        event.preventDefault();
<span class="hljs-addition">+        this.setState({</span>
<span class="hljs-addition">+            isBlocking:false</span>
<span class="hljs-addition">+        },()=>{</span>
            let username = this.usernameRef.current.value;
            UserAPI.add({ id: Date.now() + '', username });
            this.props.history.push('/user/list');
<span class="hljs-addition">+        });</span>
    }
    render() {
        return (
            <form onsubmit="{this.handleSubmit}">
<span class="hljs-addition">+                 <prompt< span>
<span class="hljs-addition">+                   when={this.state.isBlocking}</span>
<span class="hljs-addition">+                   message = {</span>
<span class="hljs-addition">+                       (location)=>`&#x8BF7;&#x95EE;&#x4F60;&#x786E;&#x5B9A;&#x8981;&#x8DF3;&#x8F6C;&#x5230;${location.pathname}&#x5417;?`</span>
<span class="hljs-addition">+                   }</span>
<span class="hljs-addition">+                /></span>
<span class="hljs-addition">+               <input type="text" ref="{this.usernameRef}" onchange="{(event)" => {</span>
<span class="hljs-addition">+                   this.setState({ isBlocking: event.target.value.length > 0 });</span>
<span class="hljs-addition">+               }} /></span>
                <button type="submit">&#x63D0;&#x4EA4;</button>
            </prompt<></span></form>
        )
    }
}
</code></pre><h3 id="t7813.3 Prompt.js">13.3 Prompt.js <a href="#t7813.3 Prompt.js">#</a></h3><p>src\react-router\Prompt.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">'./RouterContext'</span>;
<span class="hljs-keyword">import</span> LifeCycle <span class="hljs-keyword">from</span> <span class="hljs-string">'./LifeCycle'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Prompt</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">let</span> value = React.useContext(RouterContext);
    React.useEffect(<span class="hljs-function"><span class="hljs-params">()</span>=></span>{
        <span class="hljs-keyword">return</span>  value.history.block(props.message)
    });
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Prompt</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">static</span> contextType = RouterContext;
    componentDidMount(){
        <span class="hljs-keyword">const</span> block = <span class="hljs-keyword">this</span>.context.history.block;
        <span class="hljs-keyword">this</span>.release = block(<span class="hljs-keyword">this</span>.props.message)
    }
    componentWillUnmount(){
        <span class="hljs-keyword">this</span>.release()
    }
    render(){
        <span class="hljs-keyword">return</span>  <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Prompt</span>(<span class="hljs-params">{when,message}</span>)</span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">RouterContext.Consumer</span>></span>
            {
                (value)=>{
                    //&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x963B;&#x6B62;&#x8DF3;&#x8F6C;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;null,&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;
                    if(!when)return null;
                    //&#x9700;&#x8981;&#x7ED9;history&#x5BF9;&#x8C61;&#x4E0A;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;block&#x65B9;&#x6CD5;
                    const block = value.history.block;
                    return (
                        <span class="hljs-tag"><<span class="hljs-name">LifeCycle</span>
                           <span class="hljs-attr">onMount</span>=<span class="hljs-string">{lifeCycleInstance</span>=></span>lifeCycleInstance.release = block(message)}
                           onUnMount={lifeCycleInstance=>lifeCycleInstance.release()}
                        />
                    )

                }
            }
        <span class="hljs-tag">RouterContext.Consumer</span>></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Prompt;
</code></pre><h3 id="t7913.4 react-router\index.js">13.4 react-router\index.js <a href="#t7913.4 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from './Route';
export {default as Router} from './Router';
export {default as __RouterContext} from './RouterContext';
export {default as matchPath} from './matchPath';
export {default as Switch} from './Switch';
export {default as Redirect} from './Redirect';
export {default as withRouter} from './withRouter';
<span class="hljs-addition">+export {default as Prompt} from './Prompt';</span>
</code></pre><h3 id="t8013.5 createBrowserHistory.js">13.5 createBrowserHistory.js <a href="#t8013.5 createBrowserHistory.js">#</a></h3><p>src\history\createBrowserHistory.js</p><pre><code class="lang-diff">
function createBrowserHistory(props){
<span class="hljs-addition">+   let confirm =props.getUserConfirmation?props.getUserConfirmation():window.confirm;</span>
    let globalHistory = window.history;
    let listeners = [];
<span class="hljs-addition">+   let message;</span>
    function go(n){
        globalHistory.go(n);
    }
    function goBack(){
        go(-1)
    }
    function goForward(){
        go(1)
    }
    function listen(listener){
        listeners.push(listener);
        return function(){//unlisten
            listeners = listeners.filter(l=>l!==listener);
        }
    }
    function setState(newState){
        Object.assign(history,newState);
        history.length = globalHistory.length;
        listeners.forEach(listener=>listener(history.location));
    }
    /**
     * @param {*} pathname &#x53EF;&#x80FD;&#x662F;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x5B57;&#x7B26;&#x4E32;
     * @param {*} state &#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#x662F;&#x4EC0;&#x4E48;,&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x63CF;&#x8FF0;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x653E;&#x4EFB;&#x4F55;
     */
    function push(pathname, state){
        const action = 'PUSH';//&#x8868;&#x793A;&#x53D1;&#x4E86;&#x4EC0;&#x4E48;&#x52A8;&#x4F5C;&#x5F15;&#x8D77;&#x4E86;&#x8DEF;&#x5F84;&#x53D8;&#x5316; POP PUSH
        if(typeof pathname
            state=pathname.state;
            pathname= pathname.pathname;
        }
<span class="hljs-addition">+        if(message){</span>
<span class="hljs-addition">+            let showMessage = message({pathname});</span>
<span class="hljs-addition">+            let allow = confirm(showMessage);</span>
<span class="hljs-addition">+            if(!allow){</span>
<span class="hljs-addition">+                return;</span>
<span class="hljs-addition">+            }</span>
<span class="hljs-addition">+        }</span>
        globalHistory.pushState(state,null,pathname);
        let location = {state,pathname};
        setState({action,location});
    }
<span class="hljs-addition">+    function block(newMessage){</span>
<span class="hljs-addition">+        message=newMessage;</span>
<span class="hljs-addition">+        return ()=> message=null;</span>
<span class="hljs-addition">+    }</span>
    const history = {
        action: "POP",
        go,
        goBack,
        goForward,
        listen,
        location:{pathname:window.location.pathname,state:globalHistory.state},
        push,
<span class="hljs-addition">+        block</span>
    }
    return history;
}

export default createBrowserHistory;
</code></pre><h2 id="t8115.hooks">15.hooks <a href="#t8115.hooks">#</a></h2><h3 id="t8215.1 src\index.js">15.1 src\index.js <a href="#t8215.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> {BrowserRouter <span class="hljs-keyword">as</span> Router,Route,Link,
useParams,
useLocation,
useHistory,
useRouteMatch
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./react-router-dom'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Home</span>()</span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>&#x9996;&#x9875;<span class="hljs-tag">div</span>></span>;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">UserDetail</span>()</span>{
  <span class="hljs-keyword">let</span> params = useParams();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'params'</span>,params);
  <span class="hljs-keyword">let</span> location = useLocation();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'location'</span>,location);
  <span class="hljs-keyword">let</span> history = useHistory();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'history'</span>,history);
<span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>User id:{params.id} <span class="hljs-tag"><<span class="hljs-name">br</span>/></span>name:{location.state.name}<span class="hljs-tag">div</span>></span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Post</span>()</span>{
  <span class="hljs-keyword">let</span> match = useRouteMatch({
    <span class="hljs-attr">path</span>:<span class="hljs-string">'/post/:id'</span>,
    <span class="hljs-attr">strict</span>:<span class="hljs-literal">true</span>,
    <span class="hljs-attr">sensitive</span>:<span class="hljs-literal">true</span>
  });
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'match'</span>,match);
  <span class="hljs-keyword">return</span> match?<span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>id:{match.params.id}<span class="hljs-tag">div</span>></span>:<span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>Not Found<span class="hljs-tag">div</span>></span>
}
 ReactDOM.render(
  <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Router</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">div</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">ul</span>></span>
        <span class="hljs-tag"><<span class="hljs-name">li</span>></span><span class="hljs-tag"><<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>></span>&#x9996;&#x9875;<span class="hljs-tag">Link</span>></span><span class="hljs-tag">li</span>>
        <span class="hljs-tag"><<span class="hljs-name">li</span>></span><span class="hljs-tag"><<span class="hljs-name">Link</span>  <span class="hljs-attr">to</span>=<span class="hljs-string">{{pathname:</span>"/<span class="hljs-attr">user</span>/<span class="hljs-attr">detail</span>/<span class="hljs-attr">1</span>",<span class="hljs-attr">state:</span>{<span class="hljs-attr">id:1</span>,<span class="hljs-attr">name:</span>'&#x73E0;&#x5CF0;&#x67B6;&#x6784;'}}}></span>&#x7528;&#x6237;1&#x8BE6;&#x60C5;<span class="hljs-tag">Link</span>><span class="hljs-tag">li</span>>
        <span class="hljs-tag"><<span class="hljs-name">li</span>></span><span class="hljs-tag"><<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/post/1"</span>></span>&#x8D34;&#x5B50;<span class="hljs-tag">Link</span>><span class="hljs-tag">li</span>>
    <span class="hljs-tag">ul</span>>
    <span class="hljs-tag"><<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Home}/</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/user/detail/:id"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{UserDetail}/</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/post/:id"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Post}/</span>></span>
    <span class="hljs-tag">div</span>>
  <span class="hljs-tag">Router</span>>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>)
);

</code></pre><h3 id="t8315.2 hooks.js">15.2 hooks.js <a href="#t8315.2 hooks.js">#</a></h3><p>src\react-router\hooks.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">'./RouterContext'</span>;
<span class="hljs-keyword">import</span> matchPath <span class="hljs-keyword">from</span> <span class="hljs-string">'./matchPath'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useParams</span>()</span>{
    <span class="hljs-keyword">let</span> match = React.useContext(RouterContext).match;
    <span class="hljs-keyword">return</span> match?match.params:{};
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useLocation</span>()</span>{
    <span class="hljs-keyword">return</span> React.useContext(RouterContext).location;
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useHistory</span>()</span>{
    <span class="hljs-keyword">return</span> React.useContext(RouterContext).history;
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useRouteMatch</span>(<span class="hljs-params">path</span>)</span>{
   <span class="hljs-keyword">const</span> location = useLocation();
   <span class="hljs-keyword">let</span> match = React.useContext(RouterContext).match;
   <span class="hljs-keyword">return</span> path?matchPath(location.pathname,path):match;
}
</code></pre><h3 id="t8415.3 react-router\index.js">15.3 react-router\index.js <a href="#t8415.3 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from './Route';
export {default as Router} from './Router';
export {default as __RouterContext} from './RouterContext';
export {default as matchPath} from './matchPath';
export {default as Switch} from './Switch';
export {default as Redirect} from './Redirect';
export {default as withRouter} from './withRouter';
export {default as Prompt} from './Prompt';
<span class="hljs-addition">+export {useHistory,useLocation,useParams,useRouteMatch} from './hooks';</span>
</code></pre><h2 id="t8516.&#x8DEF;&#x7531;&#x61D2;&#x52A0;&#x8F7D;">16.&#x8DEF;&#x7531;&#x61D2;&#x52A0;&#x8F7D; <a href="#t8516.&#x8DEF;&#x7531;&#x61D2;&#x52A0;&#x8F7D;">#</a></h2><h3 id="t8616.1 src\index.js">16.1 src\index.js <a href="#t8616.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Suspense } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> {
  BrowserRouter <span class="hljs-keyword">as</span> Router, Route,Link
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lazy</span>(<span class="hljs-params">load</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    state = { <span class="hljs-attr">InnerComponent</span>: <span class="hljs-literal">null</span> }
    componentDidMount() {
      load().then(<span class="hljs-function"><span class="hljs-params">result</span> =></span> {
        <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">InnerComponent</span>: result.default || result });
      });
    }
    render() {
      <span class="hljs-keyword">let</span> { InnerComponent } = <span class="hljs-keyword">this</span>.state;
      <span class="hljs-keyword">return</span> InnerComponent ? <span class="xml"><span class="hljs-tag"><<span class="hljs-name">InnerComponent</span> /></span></span> : <span class="hljs-literal">null</span>;
    }
  }
}
<span class="hljs-keyword">const</span> LazyHome = React.lazy(<span class="hljs-function"><span class="hljs-params">()</span> =></span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/Home'</span>));
<span class="hljs-keyword">const</span> LazyLogin = React.lazy(<span class="hljs-function"><span class="hljs-params">()</span> =></span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/Login'</span>));
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Loading</span>() </span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>&#x52A0;&#x8F7D;&#x4E2D;......<span class="hljs-tag">div</span>></span>
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SuspenseHome</span>() </span>{
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span><<span class="hljs-attr">Loading</span> /></span>}>
      <span class="hljs-tag"><<span class="hljs-name">LazyHome</span> /></span>
    <span class="hljs-tag">Suspense</span>></span>
  )
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SuspenseLogin</span>() </span>{
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span><<span class="hljs-attr">Loading</span> /></span>}>
      <span class="hljs-tag"><<span class="hljs-name">LazyLogin</span> /></span>
    <span class="hljs-tag">Suspense</span>></span>
  )
}

ReactDOM.render(
  <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Router</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">div</span>></span>
       <span class="hljs-tag"><<span class="hljs-name">ul</span>></span>
              <span class="hljs-tag"><<span class="hljs-name">li</span>></span><span class="hljs-tag"><<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>></span>Home<span class="hljs-tag">Link</span>></span><span class="hljs-tag">li</span>>
              <span class="hljs-tag"><<span class="hljs-name">li</span>></span><span class="hljs-tag"><<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/login"</span>></span>User<span class="hljs-tag">Link</span>><span class="hljs-tag">li</span>>
      <span class="hljs-tag">ul</span>>
      <span class="hljs-tag"><<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{SuspenseHome}</span> /></span>
      <span class="hljs-tag"><<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{SuspenseLogin}</span> /></span>
    <span class="hljs-tag">div</span>>
  <span class="hljs-tag">Router</span>>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>)
);

</code></pre><h2 id="t87&#x94FE;&#x63A5;">&#x94FE;&#x63A5; <a href="#t87&#x94FE;&#x63A5;">#</a></h2><ul><li><a href="https://gitee.com/zhufengpeixun/zhufeng_react_router_20201106_prepare">zhufeng_react_router</a></li></ul></code></=pattern)<>``
